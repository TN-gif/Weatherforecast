# æ²‰æµ¸å¼å¤©æ°”é¢„æŠ¥APP - å®˜æ–¹å»ºè®®æ•´æ”¹å®æ–½æ–¹æ¡ˆ

> **é¡¹ç›®åç§°**: Aurora Weather (æ²‰æµ¸å¼å¤©æ°”é¢„æŠ¥)
> **å¹³å°**: HarmonyOS
> **è¯­è¨€**: ArkTS
> **æ–‡æ¡£ç‰ˆæœ¬**: v2.0
> **æœ€åæ›´æ–°**: 2025å¹´11æœˆ11æ—¥

---

## ğŸ“‹ ç›®å½•

1. [æ•´æ”¹èƒŒæ™¯ä¸ç›®æ ‡](#æ•´æ”¹èƒŒæ™¯ä¸ç›®æ ‡)
2. [å®˜æ–¹è¯„ä»·æ€»ç»“](#å®˜æ–¹è¯„ä»·æ€»ç»“)
3. [æ•´æ”¹ä¼˜å…ˆçº§çŸ©é˜µ](#æ•´æ”¹ä¼˜å…ˆçº§çŸ©é˜µ)
4. [P0 ç´§æ€¥ä¿®å¤é¡¹](#p0-ç´§æ€¥ä¿®å¤é¡¹)
5. [P1 é«˜ä¼˜å…ˆçº§é¡¹](#p1-é«˜ä¼˜å…ˆçº§é¡¹)
6. [P2 ä¸­ä¼˜å…ˆçº§é¡¹](#p2-ä¸­ä¼˜å…ˆçº§é¡¹)
7. [P3 ä½ä¼˜å…ˆçº§é¡¹](#p3-ä½ä¼˜å…ˆçº§é¡¹)
8. [æ›´æ–°åçš„4å‘¨å®æ–½è®¡åˆ’](#æ›´æ–°åçš„4å‘¨å®æ–½è®¡åˆ’)
9. [åº”æ€¥é¢„æ¡ˆä¸æ•…éšœæ¼”ç»ƒ](#åº”æ€¥é¢„æ¡ˆä¸æ•…éšœæ¼”ç»ƒ)
10. [é‡åŒ–éªŒæ”¶æ ‡å‡†](#é‡åŒ–éªŒæ”¶æ ‡å‡†)
11. [ç«‹å³æ‰§è¡Œæ¸…å•](#ç«‹å³æ‰§è¡Œæ¸…å•)

---

## ğŸ¯ æ•´æ”¹èƒŒæ™¯ä¸ç›®æ ‡

### èƒŒæ™¯

åœ¨å®Œæˆåˆæ­¥å®éªŒæ–¹æ¡ˆåï¼Œæ”¶åˆ°HarmonyOSå®˜æ–¹çš„ä¸“ä¸šè¯„å®¡æ„è§ï¼ŒæŒ‡å‡ºäº†æ¶æ„é£é™©ã€æ€§èƒ½éšæ‚£ã€æ•°æ®å±‚ç¼ºé™·ç­‰å…³é”®é—®é¢˜ã€‚å®˜æ–¹è¯„ä»·è®¤ä¸ºï¼š"è¯¥æ–¹æ¡ˆä½“ç°äº†è‰¯å¥½çš„æ¶æ„è®¾è®¡æ„è¯†ï¼Œä½†éœ€è¦åœ¨é˜²å¾¡å¼ç¼–ç¨‹ã€æ€§èƒ½é‡åŒ–ã€å…¼å®¹æ€§å…œåº•ã€æ•°æ®å®Œæ•´æ€§ç­‰æ–¹é¢åŠ å¼ºã€‚"

### æ•´æ”¹ç›®æ ‡

1. **é˜²å¾¡å¼ç¼–ç¨‹**: å¢åŠ å…³é”®è·¯å¾„çš„å¼‚å¸¸æ•è·ä¸æ¢å¤æœºåˆ¶
2. **æ€§èƒ½é‡åŒ–**: å»ºç«‹å¯æµ‹é‡çš„æ€§èƒ½æŒ‡æ ‡ä½“ç³»
3. **å…¼å®¹æ€§å…œåº•**: å®Œå–„å¤šè®¾å¤‡é€‚é…ç­–ç•¥
4. **æ•°æ®å®Œæ•´æ€§**: å¼ºåŒ–æ•°æ®åº“è¿ç§»ä¸æ ¡éªŒé€»è¾‘
5. **ç”Ÿäº§çº§è´¨é‡**: å°†æˆç†Ÿåº¦æå‡è‡³ç”Ÿäº§çº§åº”ç”¨æ°´å¹³ï¼ŒåŒæ—¶ä¿æŒå­¦ç”Ÿé¡¹ç›®çš„å¯å®ç°æ€§

---

## ğŸ“Š å®˜æ–¹è¯„ä»·æ€»ç»“

### ä¸€ã€æ¶æ„ä¸å®ç°é£é™©è¯„ä¼°

#### 1. æ€§èƒ½éšæ‚£

**é—®é¢˜1**: è§†é¢‘èƒŒæ™¯æ–¹æ¡ˆå­˜åœ¨è®¾å¤‡å…¼å®¹æ€§é—®é¢˜
- ä½ç«¯è®¾å¤‡è§†é¢‘è§£ç èƒ½åŠ›ä¸è¶³å¯èƒ½å¯¼è‡´å¡é¡¿/é»‘å±
- æ¨¡æ‹Ÿå™¨å¯èƒ½ä¸æ”¯æŒç¡¬ä»¶åŠ é€Ÿ

**é—®é¢˜2**: æ¯›ç»ç’ƒå åŠ å±‚çº§è¿‡å¤š
- å¤šå±‚`backdropBlur(20)`å åŠ å¯èƒ½å¯¼è‡´GPUè¿‡è½½

#### 2. æ•°æ®å±‚ç¼ºé™·

**é—®é¢˜1**: RDBè¿ç§»ç­–ç•¥ç¼ºå¤±
- ç‰ˆæœ¬å‡çº§æ—¶æ•°æ®åº“è¡¨ç»“æ„å˜æ›´å¯¼è‡´å´©æºƒ
- ç¼ºå°‘ç‰ˆæœ¬ç®¡ç†å’Œè¿ç§»æœºåˆ¶

**é—®é¢˜2**: ç¼“å­˜æœ‰æ•ˆæœŸç­–ç•¥è¿‡äºç®€å•
- 30åˆ†é’Ÿå›ºå®šé˜ˆå€¼æ— æ³•é€‚åº”ä¸åŒå¤©æ°”ç±»å‹
- é›·æš´ç­‰æç«¯å¤©æ°”éœ€è¦æ›´çŸ­çš„ç¼“å­˜å‘¨æœŸ

### äºŒã€ä»£ç è§„èŒƒæ·±åŒ–å»ºè®®

#### 1. ç±»å‹å®‰å…¨å¼ºåŒ–
- æ¥å£å®šä¹‰éœ€å¢åŠ è¿è¡Œæ—¶æ ¡éªŒ
- é¿å…ä½¿ç”¨any/unknownç±»å‹

#### 2. å¼‚æ­¥æ“ä½œä¼˜åŒ–
- ç½‘ç»œè¯·æ±‚ç¼ºå°‘å–æ¶ˆæœºåˆ¶
- ç¼ºå°‘è¶…æ—¶æ§åˆ¶å’Œé‡è¯•ç­–ç•¥

### ä¸‰ã€APIè°ƒç”¨å…³é”®æ³¨æ„ç‚¹

#### 1. å®šä½æœåŠ¡åˆè§„æ€§
- æƒé™å£°æ˜ä¸å®Œæ•´
- å®šä½å¤±è´¥å¤„ç†ç­–ç•¥ç¼ºå¤±

#### 2. ç½‘ç»œè¯·æ±‚å¥å£®æ€§
- ç¼ºå°‘å¤šçº§å›é€€æœºåˆ¶
- ç¼ºå°‘ç¦»çº¿æ•°æ®å±•ç¤º

### å››ã€è§†è§‰æ–¹æ¡ˆä¼˜åŒ–å»ºè®®

#### 1. åŠ¨æ€èƒŒæ™¯é™çº§ç­–ç•¥
- éœ€è¦æ ¹æ®è®¾å¤‡æ€§èƒ½è‡ªåŠ¨é€‰æ‹©èƒŒæ™¯æ–¹æ¡ˆ
- ç¼ºå°‘è§†é¢‘åŠ è½½å¤±è´¥çš„é™çº§å¤„ç†

#### 2. åŠ¨æ€åˆ†è¾¨ç‡é€‚é…
- åº”æ ¹æ®è®¾å¤‡åˆ†è¾¨ç‡é€‰æ‹©ä¸åŒè´¨é‡çš„è§†é¢‘èµ„æº

### äº”ã€æµ‹è¯•æ–¹æ¡ˆå¼ºåŒ–

#### 1. æ€§èƒ½æµ‹è¯•æŒ‡æ ‡
- éœ€è¦åˆ¶å®šé‡åŒ–æ ‡å‡†
- ç¼ºå°‘æ€§èƒ½ç›‘æ§å·¥å…·

#### 2. å¼‚å¸¸æµæµ‹è¯•ç”¨ä¾‹
- éœ€è¦æ¨¡æ‹Ÿæç«¯ç½‘ç»œçŠ¶å†µ
- éœ€è¦æµ‹è¯•æ•°æ®åº“æŸåæ¢å¤èƒ½åŠ›

---

## ğŸ¯ æ•´æ”¹ä¼˜å…ˆçº§çŸ©é˜µ

| ä¼˜å…ˆçº§ | ç±»åˆ« | å½±å“èŒƒå›´ | æ‰§è¡Œæ—¶é—´ | å…³é”®æŒ‡æ ‡ |
|--------|------|----------|----------|----------|
| **P0 ç´§æ€¥** | æ•°æ®åº“è¿ç§»ã€æƒé™é…ç½®ã€module.json5ä¿®å¤ | é˜»å¡æ€§é£é™© | Day 1-2 | æ— å´©æºƒã€æ— ç¼–è¯‘é”™è¯¯ |
| **P1 é«˜** | æ€§èƒ½æ£€æµ‹ã€é”™è¯¯æ¢å¤ã€ç½‘ç»œé‡è¯•ã€å®šä½å›é€€ | ç”¨æˆ·ä½“éªŒæ ¸å¿ƒ | Day 3-7 | FPSâ‰¥50, ç½‘ç»œæˆåŠŸç‡â‰¥95% |
| **P2 ä¸­** | ç¼“å­˜ä¼˜åŒ–ã€é™çº§ç­–ç•¥ã€æ¯›ç»ç’ƒä¼˜åŒ– | ç¨³å®šæ€§å¢å¼º | Week 2 | ç¼“å­˜å‘½ä¸­ç‡â‰¥80% |
| **P3 ä½** | æ€§èƒ½é¢æ¿ã€æ•°æ®æ ¡éªŒã€é«˜çº§åŠŸèƒ½ | å¼€å‘ä½“éªŒ | Week 3-4 | å®Œæ•´çš„ç›‘æ§æ•°æ® |

---

## ğŸ”¥ P0 ç´§æ€¥ä¿®å¤é¡¹ï¼ˆDay 1-2ï¼‰

### 1. æ•°æ®åº“ç‰ˆæœ¬è¿ç§»æœºåˆ¶

**é—®é¢˜**: ç‰ˆæœ¬å‡çº§æ—¶è¡¨ç»“æ„å˜æ›´å¯¼è‡´å´©æºƒï¼ˆå®˜æ–¹æŒ‡å‡ºçš„ä¸¥é‡ç¼ºé™·ï¼‰

**é£é™©ç­‰çº§**: ğŸ”´ ä¸¥é‡

**è§£å†³æ–¹æ¡ˆ**: åˆ›å»ºå®Œæ•´çš„æ•°æ®åº“è¿ç§»ç³»ç»Ÿ

#### å®ç°ä»£ç 

```typescript
// data/storage/CityStorage.ets - å¢å¼ºç‰ˆæœ¬

import relationalStore from '@ohos.data.relationalStore';
import type common from '@ohos.app.ability.common';
import { City, CitySource } from '../models/WeatherModels';

export class CityStorage {
  private rdbStore: relationalStore.RdbStore | null = null;
  private static readonly DB_NAME = 'weather.db';
  private static readonly TABLE_CITIES = 'cities';
  private static readonly CURRENT_VERSION = 2; // âœ… ç‰ˆæœ¬æ§åˆ¶

  async init(context: common.UIAbilityContext): Promise<void> {
    const config: relationalStore.StoreConfig = {
      name: CityStorage.DB_NAME,
      securityLevel: relationalStore.SecurityLevel.S1,
      encrypt: false,
      // âœ… å…³é”®ï¼šç‰ˆæœ¬ç®¡ç†
      version: CityStorage.CURRENT_VERSION,
    };

    try {
      this.rdbStore = await relationalStore.getRdbStore(context, config);

      // âœ… æ£€æŸ¥å¹¶æ‰§è¡Œè¿ç§»
      await this.migrate();

      console.info('[CityStorage] Database initialized successfully, version:', CityStorage.CURRENT_VERSION);
    } catch (error) {
      let err = error as Error;
      console.error('[CityStorage] Database initialization failed:', err.message);

      // âœ… é˜²å¾¡å¼ç¼–ç¨‹ï¼šæ•°æ®åº“æŸåæ¢å¤
      await this.recoverFromCorruption(context);
    }
  }

  /**
   * æ•°æ®åº“è¿ç§»é€»è¾‘
   */
  private async migrate(): Promise<void> {
    if (!this.rdbStore) {
      throw new Error('Database not initialized');
    }

    // è·å–å½“å‰ç‰ˆæœ¬
    const currentVersion = await this.getCurrentSchemaVersion();

    console.info(`[CityStorage] Migration check: DB version ${currentVersion} -> ${CityStorage.CURRENT_VERSION}`);

    // âœ… ç‰ˆæœ¬1 -> ç‰ˆæœ¬2ï¼šæ·»åŠ  timeZoneOffsetMinutes å­—æ®µ
    if (currentVersion < 2) {
      console.info('[CityStorage] Migrating to version 2: Adding timeZoneOffsetMinutes column');
      try {
        await this.rdbStore.executeSql(
          `ALTER TABLE ${CityStorage.TABLE_CITIES} ADD COLUMN timeZoneOffsetMinutes INTEGER DEFAULT 0`
        );
        console.info('[CityStorage] âœ… Migration to version 2 completed');
      } catch (error) {
        let err = error as Error;
        // å­—æ®µå·²å­˜åœ¨åˆ™å¿½ç•¥é”™è¯¯
        if (!err.message.includes('duplicate column')) {
          throw error;
        }
      }
    }

    // âœ… æœªæ¥ç‰ˆæœ¬é¢„ç•™
    if (currentVersion < 3) {
      // ç‰ˆæœ¬3è¿ç§»é€»è¾‘é¢„ç•™ä½ç½®
    }

    // æ›´æ–°ç‰ˆæœ¬è®°å½•
    await this.updateSchemaVersion(CityStorage.CURRENT_VERSION);
  }

  /**
   * è·å–å½“å‰æ•°æ®åº“schemaç‰ˆæœ¬
   */
  private async getCurrentSchemaVersion(): Promise<number> {
    if (!this.rdbStore) return 0;

    try {
      // åˆ›å»ºå…ƒæ•°æ®è¡¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
      await this.rdbStore.executeSql(`
        CREATE TABLE IF NOT EXISTS schema_metadata (
          key TEXT PRIMARY KEY,
          value INTEGER NOT NULL
        )
      `);

      const predicates = new relationalStore.RdbPredicates('schema_metadata');
      predicates.equalTo('key', 'version');

      const resultSet = await this.rdbStore.query(predicates);

      try {
        if (resultSet.goToFirstRow()) {
          return resultSet.getLong(resultSet.getColumnIndex('value'));
        }
        return 1; // é»˜è®¤ç‰ˆæœ¬1
      } finally {
        resultSet.close();
      }
    } catch (error) {
      console.warn('[CityStorage] Failed to get schema version, assuming version 1');
      return 1;
    }
  }

  /**
   * æ›´æ–°schemaç‰ˆæœ¬è®°å½•
   */
  private async updateSchemaVersion(version: number): Promise<void> {
    if (!this.rdbStore) return;

    const valueBucket: relationalStore.ValuesBucket = {
      'key': 'version',
      'value': version
    };

    await this.rdbStore.insert('schema_metadata', valueBucket,
      relationalStore.ConflictResolution.ON_CONFLICT_REPLACE
    );
  }

  /**
   * æ•°æ®åº“æŸåæ¢å¤æœºåˆ¶
   */
  private async recoverFromCorruption(context: common.UIAbilityContext): Promise<void> {
    console.warn('[CityStorage] âš ï¸ Attempting database recovery...');

    try {
      // âœ… åˆ é™¤æŸåçš„æ•°æ®åº“
      await relationalStore.deleteRdbStore(context, CityStorage.DB_NAME);
      console.info('[CityStorage] Corrupted database deleted');

      // âœ… é‡æ–°åˆå§‹åŒ–
      const config: relationalStore.StoreConfig = {
        name: CityStorage.DB_NAME,
        securityLevel: relationalStore.SecurityLevel.S1,
        version: CityStorage.CURRENT_VERSION,
      };

      this.rdbStore = await relationalStore.getRdbStore(context, config);

      // âœ… åˆ›å»ºè¡¨
      await this.createTables();

      console.info('[CityStorage] âœ… Database recovered successfully');
    } catch (error) {
      let err = error as Error;
      console.error('[CityStorage] âŒ Database recovery failed:', err.message);
      throw new Error('æ— æ³•æ¢å¤æ•°æ®åº“ï¼Œè¯·é‡æ–°å®‰è£…åº”ç”¨');
    }
  }

  /**
   * åˆ›å»ºåˆå§‹è¡¨ç»“æ„
   */
  private async createTables(): Promise<void> {
    if (!this.rdbStore) return;

    const createCitiesTable = `
      CREATE TABLE IF NOT EXISTS ${CityStorage.TABLE_CITIES} (
        id TEXT PRIMARY KEY,
        name TEXT NOT NULL,
        country TEXT NOT NULL,
        latitude REAL NOT NULL,
        longitude REAL NOT NULL,
        source INTEGER NOT NULL,
        videoTheme TEXT NOT NULL,
        timeZoneOffsetMinutes INTEGER NOT NULL DEFAULT 0,
        displayOrder INTEGER NOT NULL DEFAULT 0,
        createdAt INTEGER NOT NULL,
        updatedAt INTEGER NOT NULL
      )
    `;

    await this.rdbStore.executeSql(createCitiesTable);

    // åˆ›å»ºç´¢å¼•æå‡æŸ¥è¯¢æ€§èƒ½
    await this.rdbStore.executeSql(`
      CREATE INDEX IF NOT EXISTS idx_display_order
      ON ${CityStorage.TABLE_CITIES} (displayOrder)
    `);
  }

  // ... å…¶ä»–CRUDæ–¹æ³•
}
```

#### éªŒæ”¶æ ‡å‡†

- [ ] ä»ç‰ˆæœ¬1å‡çº§åˆ°ç‰ˆæœ¬2æ— æŠ¥é”™
- [ ] æ•°æ®åº“æŸååèƒ½è‡ªåŠ¨é‡å»º
- [ ] æ—§ç‰ˆæœ¬æ•°æ®èƒ½å®Œæ•´è¿ç§»
- [ ] è¿ç§»æ—¶é—´ <500ms

#### é¢„ä¼°å·¥æ—¶

4å°æ—¶

---

### 2. å®Œæ•´æƒé™é…ç½®

**é—®é¢˜**: æƒé™å£°æ˜ä¸å®Œæ•´ï¼Œå¯èƒ½å¯¼è‡´å®šä½åŠŸèƒ½å¤±è´¥

**é£é™©ç­‰çº§**: ğŸ”´ ä¸¥é‡

**è§£å†³æ–¹æ¡ˆ**: è¡¥å……å®Œæ•´çš„æƒé™é…ç½®

#### é…ç½®æ–‡ä»¶

```json5
// entry/src/main/module.json5

{
  "module": {
    "name": "entry",
    "type": "entry",
    "description": "$string:module_desc",
    "mainElement": "EntryAbility",
    "deviceTypes": ["phone", "tablet"],

    // âœ… APIç‰ˆæœ¬å£°æ˜ï¼ˆå®˜æ–¹å»ºè®®ï¼‰
    "metadata": [
      {
        "name": "ArkTS-specific-framework-api-version",
        "value": "9"
      }
    ],

    "deliveryWithInstall": true,
    "installationFree": false,
    "pages": "$profile:main_pages",

    "abilities": [
      {
        "name": "EntryAbility",
        "srcEntry": "./ets/entryability/EntryAbility.ets",
        "description": "$string:EntryAbility_desc",
        "icon": "$media:layered_image",
        "label": "$string:EntryAbility_label",
        "startWindowIcon": "$media:startIcon",
        "startWindowBackground": "$color:start_window_background",
        "exported": true,
        "skills": [
          {
            "entities": ["entity.system.home"],
            "actions": ["ohos.want.action.home"]
          }
        ]
      }
    ],

    "extensionAbilities": [
      {
        "name": "EntryBackupAbility",
        "srcEntry": "./ets/entrybackupability/EntryBackupAbility.ets",
        "type": "backup",
        "exported": false,
        "metadata": [
          {
            "name": "ohos.extension.backup",
            "resource": "$profile:backup_config"
          }
        ]
      }
    ],

    // âœ… å®Œæ•´çš„æƒé™é…ç½®ï¼ˆå®˜æ–¹è¦æ±‚ï¼‰
    "requestPermissions": [
      {
        "name": "ohos.permission.INTERNET",
        "reason": "$string:permission_internet_reason",
        "usedScene": {
          "abilities": ["EntryAbility"],
          "when": "inuse"
        }
      },
      {
        "name": "ohos.permission.GET_NETWORK_INFO",
        "reason": "$string:permission_network_info_reason",
        "usedScene": {
          "abilities": ["EntryAbility"],
          "when": "inuse"
        }
      },
      {
        "name": "ohos.permission.LOCATION",
        "reason": "$string:permission_location_reason",
        "usedScene": {
          "abilities": ["EntryAbility"],
          "when": "inuse"
        }
      },
      {
        "name": "ohos.permission.APPROXIMATELY_LOCATION",
        "reason": "$string:permission_approx_location_reason",
        "usedScene": {
          "abilities": ["EntryAbility"],
          "when": "inuse"
        }
      },
      {
        "name": "ohos.permission.LOCATION_IN_BACKGROUND",
        "reason": "$string:permission_location_background_reason",
        "usedScene": {
          "abilities": ["EntryAbility"],
          "when": "always"
        }
      }
    ]
  }
}
```

#### å­—ç¬¦ä¸²èµ„æº

```json
// entry/src/main/resources/zh_CN/element/string.json

{
  "string": [
    {
      "name": "permission_internet_reason",
      "value": "éœ€è¦è®¿é—®ç½‘ç»œä»¥è·å–å®æ—¶å¤©æ°”æ•°æ®"
    },
    {
      "name": "permission_network_info_reason",
      "value": "éœ€è¦æ£€æŸ¥ç½‘ç»œçŠ¶æ€ä»¥æä¾›æœ€ä½³ä½“éªŒ"
    },
    {
      "name": "permission_location_reason",
      "value": "éœ€è¦è·å–æ‚¨çš„ä½ç½®ä»¥æ˜¾ç¤ºå½“å‰åœ°åŒºå¤©æ°”ä¿¡æ¯"
    },
    {
      "name": "permission_approx_location_reason",
      "value": "ä½¿ç”¨ç²—ç•¥ä½ç½®å³å¯è·å–å¤©æ°”æ•°æ®"
    },
    {
      "name": "permission_location_background_reason",
      "value": "åå°å®šä½ç”¨äºè‡ªåŠ¨æ›´æ–°å½“å‰ä½ç½®å¤©æ°”"
    }
  ]
}
```

#### éªŒæ”¶æ ‡å‡†

- [ ] å®‰è£…æ—¶æ­£ç¡®æ˜¾ç¤ºæƒé™ç”³è¯·
- [ ] æƒé™æ‹’ç»åæœ‰å‹å¥½æç¤º
- [ ] é€šè¿‡åä¸ºåº”ç”¨å¸‚åœºæƒé™å®¡æ ¸

#### é¢„ä¼°å·¥æ—¶

1å°æ—¶

---

### 3. ä¿®å¤module.json5è¯­æ³•é”™è¯¯

**é—®é¢˜**: ç¬¬47è¡Œæœ‰å¤šä½™çš„é€—å·

**é£é™©ç­‰çº§**: ğŸ”´ é˜»å¡ç¼–è¯‘

**è§£å†³æ–¹æ¡ˆ**:

```json5
// entry/src/main/module.json5 - ç¬¬35-49è¡Œ

"extensionAbilities": [
  {
    "name": "EntryBackupAbility",
    "srcEntry": "./ets/entrybackupability/EntryBackupAbility.ets",
    "type": "backup",
    "exported": false,
    "metadata": [
      {
        "name": "ohos.extension.backup",
        "resource": "$profile:backup_config"
      }
    ]
    // âœ… åˆ é™¤è¿™é‡Œçš„é€—å·
  }
]
```

#### éªŒæ”¶æ ‡å‡†

- [ ] é¡¹ç›®å¯ä»¥æ­£å¸¸ç¼–è¯‘
- [ ] æ— JSON5è¯­æ³•é”™è¯¯

#### é¢„ä¼°å·¥æ—¶

5åˆ†é’Ÿ

---

## ğŸ¯ P1 é«˜ä¼˜å…ˆçº§é¡¹ï¼ˆDay 3-7ï¼‰

### 1. æ€§èƒ½æ£€æµ‹ä¸è‡ªé€‚åº”é™çº§ç³»ç»Ÿ

**é—®é¢˜**: è§†é¢‘èƒŒæ™¯åœ¨ä½ç«¯è®¾å¤‡å¡é¡¿/é»‘å±

**é£é™©ç­‰çº§**: ğŸŸ¡ é«˜

**è§£å†³æ–¹æ¡ˆ**: åˆ›å»ºè®¾å¤‡æ€§èƒ½æ£€æµ‹å™¨

#### å®ç°ä»£ç 

```typescript
// common/utils/DevicePerformanceDetector.ets

import deviceInfo from '@ohos.deviceInfo';
import display from '@ohos.display';

export enum PerformanceLevel {
  HIGH = 'high',      // é«˜ç«¯è®¾å¤‡ï¼šæ”¯æŒè§†é¢‘èƒŒæ™¯
  MEDIUM = 'medium',  // ä¸­ç«¯è®¾å¤‡ï¼šæ”¯æŒAnimatedImage
  LOW = 'low'         // ä½ç«¯è®¾å¤‡ï¼šä»…é™æ€æ¸å˜
}

export interface DeviceCapability {
  performanceLevel: PerformanceLevel;
  totalMemoryMB: number;
  screenWidth: number;
  screenHeight: number;
  deviceType: string;
  apiVersion: number;
  supportsHardwareAcceleration: boolean;
}

export class DevicePerformanceDetector {
  private static instance: DevicePerformanceDetector | null = null;
  private capability: DeviceCapability | null = null;

  private constructor() {}

  static getInstance(): DevicePerformanceDetector {
    if (DevicePerformanceDetector.instance === null) {
      DevicePerformanceDetector.instance = new DevicePerformanceDetector();
    }
    return DevicePerformanceDetector.instance;
  }

  /**
   * æ£€æµ‹è®¾å¤‡æ€§èƒ½ç­‰çº§
   */
  async detect(): Promise<DeviceCapability> {
    if (this.capability !== null) {
      return this.capability;
    }

    console.info('[DevicePerformanceDetector] Starting device capability detection...');

    // âœ… è·å–è®¾å¤‡ä¿¡æ¯
    const deviceType = deviceInfo.deviceType; // 'phone' | 'tablet' | 'default'
    const apiVersion = deviceInfo.sdkApiVersion || 9;

    // âœ… è·å–å±å¹•ä¿¡æ¯
    const displayInfo = display.getDefaultDisplaySync();
    const screenWidth = displayInfo.width;
    const screenHeight = displayInfo.height;
    const densityPixels = displayInfo.densityPixels;

    // âœ… ä¼°ç®—è®¾å¤‡å†…å­˜ï¼ˆHarmonyOSæš‚æ— ç›´æ¥APIï¼Œé€šè¿‡å±å¹•åˆ†è¾¨ç‡æ¨æ–­ï¼‰
    const estimatedMemory = this.estimateDeviceMemory(screenWidth, screenHeight, densityPixels);

    // âœ… åˆ¤æ–­æ€§èƒ½ç­‰çº§
    const performanceLevel = this.calculatePerformanceLevel(
      estimatedMemory,
      screenWidth,
      apiVersion,
      deviceType
    );

    // âœ… ç¡¬ä»¶åŠ é€Ÿæ”¯æŒæ£€æµ‹ï¼ˆåŸºäºAPIç‰ˆæœ¬ï¼‰
    const supportsHardwareAcceleration = apiVersion >= 9;

    this.capability = {
      performanceLevel: performanceLevel,
      totalMemoryMB: estimatedMemory,
      screenWidth: screenWidth,
      screenHeight: screenHeight,
      deviceType: deviceType,
      apiVersion: apiVersion,
      supportsHardwareAcceleration: supportsHardwareAcceleration
    };

    console.info('[DevicePerformanceDetector] Detection complete:', JSON.stringify(this.capability));

    return this.capability;
  }

  /**
   * ä¼°ç®—è®¾å¤‡å†…å­˜ï¼ˆåŸºäºå±å¹•åˆ†è¾¨ç‡ï¼‰
   */
  private estimateDeviceMemory(width: number, height: number, density: number): number {
    const pixels = width * height;
    const dpi = density * 160; // è½¬æ¢ä¸ºDPI

    // ä¼°ç®—è§„åˆ™ï¼ˆåŸºäºç»éªŒå€¼ï¼‰
    if (pixels >= 1920 * 1080 && dpi >= 400) {
      return 6144; // 6GB+ é«˜ç«¯è®¾å¤‡
    } else if (pixels >= 1280 * 720 && dpi >= 300) {
      return 4096; // 4GB ä¸­ç«¯è®¾å¤‡
    } else {
      return 2048; // 2GB ä½ç«¯è®¾å¤‡
    }
  }

  /**
   * è®¡ç®—æ€§èƒ½ç­‰çº§
   */
  private calculatePerformanceLevel(
    memoryMB: number,
    screenWidth: number,
    apiVersion: number,
    deviceType: string
  ): PerformanceLevel {
    // âœ… è§„åˆ™1ï¼šä½å†…å­˜è®¾å¤‡å¼ºåˆ¶é™çº§
    if (memoryMB < 3072) { // <3GB
      console.warn('[DevicePerformanceDetector] Low memory detected, using LOW performance mode');
      return PerformanceLevel.LOW;
    }

    // âœ… è§„åˆ™2ï¼šä½APIç‰ˆæœ¬é™çº§
    if (apiVersion < 9) {
      console.warn('[DevicePerformanceDetector] Low API version, using MEDIUM performance mode');
      return PerformanceLevel.MEDIUM;
    }

    // âœ… è§„åˆ™3ï¼šå¹³æ¿ä¼˜å…ˆä½¿ç”¨é«˜æ€§èƒ½
    if (deviceType === 'tablet' && memoryMB >= 4096) {
      return PerformanceLevel.HIGH;
    }

    // âœ… è§„åˆ™4ï¼šé«˜åˆ†è¾¨ç‡ + é«˜å†…å­˜ = é«˜æ€§èƒ½
    if (screenWidth >= 1080 && memoryMB >= 4096) {
      return PerformanceLevel.HIGH;
    }

    // âœ… é»˜è®¤ä¸­ç­‰æ€§èƒ½
    return PerformanceLevel.MEDIUM;
  }

  /**
   * è·å–æ¨èçš„èƒŒæ™¯æ¨¡å¼
   */
  getRecommendedBackgroundMode(): BackgroundMode {
    if (this.capability === null) {
      return BackgroundMode.GRADIENT; // é»˜è®¤å®‰å…¨æ¨¡å¼
    }

    switch (this.capability.performanceLevel) {
      case PerformanceLevel.HIGH:
        return BackgroundMode.VIDEO;
      case PerformanceLevel.MEDIUM:
        return BackgroundMode.ANIMATED_IMAGE;
      case PerformanceLevel.LOW:
      default:
        return BackgroundMode.GRADIENT;
    }
  }

  /**
   * è·å–æ¨èçš„è§†é¢‘åˆ†è¾¨ç‡
   */
  getRecommendedVideoResolution(): string {
    if (this.capability === null) {
      return 'hd.mp4';
    }

    if (this.capability.screenWidth >= 1920) {
      return '4k.mp4';
    } else if (this.capability.screenWidth >= 1080) {
      return 'fullhd.mp4';
    } else {
      return 'hd.mp4';
    }
  }
}

// å¯¼å‡ºBackgroundModeæšä¸¾
export enum BackgroundMode {
  VIDEO = 'video',
  ANIMATED_IMAGE = 'animated_image',
  GRADIENT = 'gradient'
}
```

#### é›†æˆåˆ°AtmosphereBackgroundç»„ä»¶

```typescript
// components/background/AtmosphereBackground.ets - å¢å¼ºç‰ˆ

import { ThemeHelper } from '../../common/utils/ThemeHelper';
import { VideoThemeAsset } from '../../common/constants/ThemeConstants';
import { DevicePerformanceDetector, BackgroundMode } from '../../common/utils/DevicePerformanceDetector';

@Component
export struct AtmosphereBackground {
  @Prop themeKey: string = 'sunny';
  @State private pulse: number = 0;
  @StorageLink('backgroundMode') @Watch('onBackgroundModeChange') private backgroundMode: BackgroundMode = BackgroundMode.GRADIENT;
  @State private videoLoadFailed: boolean = false;
  @State private animatedImageLoadFailed: boolean = false;

  private videoController: VideoController = new VideoController();
  private performanceDetector: DevicePerformanceDetector = DevicePerformanceDetector.getInstance();

  async aboutToAppear(): Promise<void> {
    // âœ… æ€§èƒ½æ£€æµ‹ä¸è‡ªåŠ¨é™çº§
    await this.initializeBackgroundMode();
    this.startPulse();
  }

  /**
   * åˆå§‹åŒ–èƒŒæ™¯æ¨¡å¼ï¼ˆåŸºäºæ€§èƒ½æ£€æµ‹ï¼‰
   */
  private async initializeBackgroundMode(): Promise<void> {
    try {
      const capability = await this.performanceDetector.detect();
      const recommendedMode = this.performanceDetector.getRecommendedBackgroundMode();

      console.info(`[AtmosphereBackground] Device performance: ${capability.performanceLevel}`);
      console.info(`[AtmosphereBackground] Recommended mode: ${recommendedMode}`);

      // âœ… è®¾ç½®æ¨èæ¨¡å¼
      AppStorage.setOrCreate('backgroundMode', recommendedMode);

      // âœ… è®°å½•æ€§èƒ½ç­‰çº§ä¾›å…¶ä»–ç»„ä»¶ä½¿ç”¨
      AppStorage.setOrCreate('devicePerformanceLevel', capability.performanceLevel);

    } catch (error) {
      let err = error as Error;
      console.error('[AtmosphereBackground] Performance detection failed:', err.message);
      // å¤±è´¥æ—¶ä½¿ç”¨æœ€å®‰å…¨çš„æ¨¡å¼
      AppStorage.setOrCreate('backgroundMode', BackgroundMode.GRADIENT);
    }
  }

  /**
   * èƒŒæ™¯æ¨¡å¼å˜åŒ–ç›‘å¬
   */
  private onBackgroundModeChange(): void {
    console.info(`[AtmosphereBackground] Background mode changed to: ${this.backgroundMode}`);
  }

  startPulse(): void {
    animateTo({
      duration: 3200,
      curve: Curve.Linear,
      iterations: -1,
      playMode: PlayMode.Alternate
    }, () => {
      this.pulse = this.pulse === 1 ? 0 : 1;
    });
  }

  build() {
    Stack() {
      // âœ… æ ¹æ®æ¨¡å¼æ¸²æŸ“ä¸åŒèƒŒæ™¯
      if (this.backgroundMode === BackgroundMode.VIDEO && !this.videoLoadFailed) {
        this.renderVideoBackground();
      } else if (this.backgroundMode === BackgroundMode.ANIMATED_IMAGE && !this.animatedImageLoadFailed) {
        this.renderAnimatedImageBackground();
      } else {
        this.renderGradientBackground();
      }

      // ç»Ÿä¸€çš„é®ç½©å±‚
      Column()
        .width('100%')
        .height('100%')
        .backgroundColor('rgba(0, 0, 0, 0.18)');
    }
    .width('100%')
    .height('100%');
  }

  /**
   * è§†é¢‘èƒŒæ™¯ï¼ˆPlan Aï¼‰
   */
  @Builder
  private renderVideoBackground(): void {
    const videoResolution = this.performanceDetector.getRecommendedVideoResolution();
    const videoResource = `rawfile/weather/${this.themeKey}_${videoResolution}`;

    Video({
      src: videoResource,
      controller: this.videoController
    })
      .width('100%')
      .height('100%')
      .autoPlay(true)
      .loop(true)
      .muted(true)
      .objectFit(ImageFit.Cover)
      .onError((error: Error) => {
        console.error('[AtmosphereBackground] Video load failed:', error.message);
        // âœ… è§†é¢‘åŠ è½½å¤±è´¥ï¼Œè‡ªåŠ¨é™çº§åˆ°AnimatedImage
        this.videoLoadFailed = true;
        AppStorage.setOrCreate('backgroundMode', BackgroundMode.ANIMATED_IMAGE);
      })
      // âœ… æ€§èƒ½ä¼˜åŒ–ï¼šå¼€å¯æ¸²æŸ“ç¼“å­˜
      .compositingStrategy(CompositingStrategy.OFFSCREEN);
  }

  /**
   * åŠ¨ç”»å›¾ç‰‡èƒŒæ™¯ï¼ˆPlan Bï¼‰
   */
  @Builder
  private renderAnimatedImageBackground(): void {
    const animatedImageResource = `rawfile/weather/${this.themeKey}.webp`;

    Image(animatedImageResource)
      .width('100%')
      .height('100%')
      .objectFit(ImageFit.Cover)
      .onError((error: Error) => {
        console.error('[AtmosphereBackground] AnimatedImage load failed:', error.message);
        // âœ… åŠ¨ç”»å›¾ç‰‡å¤±è´¥ï¼Œæœ€ç»ˆé™çº§åˆ°é™æ€æ¸å˜
        this.animatedImageLoadFailed = true;
        AppStorage.setOrCreate('backgroundMode', BackgroundMode.GRADIENT);
      });
  }

  /**
   * æ¸å˜èƒŒæ™¯ï¼ˆPlan C - å…œåº•æ–¹æ¡ˆï¼‰
   */
  @Builder
  private renderGradientBackground(): void {
    Column()
      .width('100%')
      .height('100%')
      .backgroundColor(this.primaryColor());

    // æ°”æ³¡åŠ¨ç”»
    ForEach([0, 1, 2], (index: number) => {
      const baseOpacity: number = 0.35 - index * 0.08;
      const offsetX: number = index * 60;
      const offsetY: number = index * 120;

      Column()
        .width(220 - index * 30)
        .height(220 - index * 30)
        .backgroundColor(this.bubbleColor())
        .borderRadius(180)
        .margin({
          left: 40 + offsetX,
          top: 80 + offsetY
        })
        .opacity(baseOpacity + this.pulse * 0.15);
    }, (index: number) => index.toString());
  }

  private primaryColor(): string {
    const theme: VideoThemeAsset = ThemeHelper.resolveTheme({
      description: '',
      iconCode: '',
      themeKey: this.themeKey,
      emotion: ''
    });
    return theme.gradientColors[0];
  }

  private bubbleColor(): string {
    const theme: VideoThemeAsset = ThemeHelper.resolveTheme({
      description: '',
      iconCode: '',
      themeKey: this.themeKey,
      emotion: ''
    });
    return theme.accentColor ?? 'rgba(255,255,255,0.35)';
  }
}
```

#### éªŒæ”¶æ ‡å‡†

- [ ] ä½ç«¯è®¾å¤‡è‡ªåŠ¨ä½¿ç”¨æ¸å˜èƒŒæ™¯
- [ ] é«˜ç«¯è®¾å¤‡æµç•…æ’­æ”¾è§†é¢‘
- [ ] è§†é¢‘åŠ è½½å¤±è´¥è‡ªåŠ¨é™çº§
- [ ] æ¨¡æ‹Ÿå™¨ç¯å¢ƒæ­£ç¡®è¯†åˆ«
- [ ] FPS â‰¥50

#### é¢„ä¼°å·¥æ—¶

6å°æ—¶

---

### 2. ç½‘ç»œè¯·æ±‚è¶…æ—¶ä¸é‡è¯•æœºåˆ¶

**é—®é¢˜**: ç½‘ç»œè¯·æ±‚ç¼ºå°‘å–æ¶ˆæœºåˆ¶å’Œé‡è¯•ç­–ç•¥

**é£é™©ç­‰çº§**: ğŸŸ¡ é«˜

**è§£å†³æ–¹æ¡ˆ**: å¢å¼ºWeatherService

#### å®ç°ä»£ç 

```typescript
// data/services/WeatherService.ets - å¢å¼ºç‰ˆ

import http from '@ohos.net.http';
import { Coordinates, WeatherSnapshot, WeatherApiConfig } from '../models/WeatherModels';

interface RetryConfig {
  maxRetries: number;
  baseDelay: number;      // åŸºç¡€å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
  maxDelay: number;       // æœ€å¤§å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
  backoffMultiplier: number; // é€€é¿å€æ•°
}

export class WeatherService {
  private readonly config: WeatherApiConfig;
  private currentRequest: http.HttpRequest | null = null;
  private requestTimeoutHandle: number | null = null;

  // âœ… é‡è¯•é…ç½®
  private readonly retryConfig: RetryConfig = {
    maxRetries: 3,
    baseDelay: 1000,
    maxDelay: 10000,
    backoffMultiplier: 2
  };

  constructor(config: WeatherApiConfig) {
    this.config = config;
  }

  /**
   * è·å–å¤©æ°”æ•°æ®ï¼ˆå¸¦é‡è¯•å’Œè¶…æ—¶æ§åˆ¶ï¼‰
   */
  async fetchWeather(cityId: string, coordinates: Coordinates): Promise<WeatherSnapshot> {
    // âœ… å–æ¶ˆä¸Šä¸€ä¸ªè¯·æ±‚
    this.cancelCurrentRequest();

    const query = this.buildQuery(coordinates);

    let lastError: Error | null = null;

    // âœ… é‡è¯•å¾ªç¯
    for (let attempt = 1; attempt <= this.retryConfig.maxRetries; attempt++) {
      try {
        console.info(`[WeatherService] Attempt ${attempt}/${this.retryConfig.maxRetries} for city ${cityId}`);

        const snapshot = await this.executeRequest(query, cityId);

        console.info(`[WeatherService] âœ… Successfully fetched weather for ${cityId}`);
        return snapshot;

      } catch (error) {
        lastError = error as Error;
        console.error(`[WeatherService] Attempt ${attempt} failed:`, lastError.message);

        // âœ… åˆ¤æ–­æ˜¯å¦åº”è¯¥é‡è¯•
        if (attempt < this.retryConfig.maxRetries && this.isRetryableError(lastError)) {
          const delay = this.calculateRetryDelay(attempt);
          console.info(`[WeatherService] Retrying in ${delay}ms...`);
          await this.sleep(delay);
        } else {
          break;
        }
      }
    }

    // âœ… æ‰€æœ‰é‡è¯•éƒ½å¤±è´¥
    const errorMessage = lastError?.message || 'ç½‘ç»œè¯·æ±‚å¤±è´¥';
    console.error(`[WeatherService] âŒ All ${this.retryConfig.maxRetries} attempts failed:`, errorMessage);
    throw new Error(`å¤©æ°”æ•°æ®è·å–å¤±è´¥: ${errorMessage}`);
  }

  /**
   * æ‰§è¡Œå•æ¬¡HTTPè¯·æ±‚
   */
  private async executeRequest(query: string, cityId: string): Promise<WeatherSnapshot> {
    this.currentRequest = http.createHttp();

    try {
      // âœ… è®¾ç½®è¯·æ±‚è¶…æ—¶
      const requestPromise = this.currentRequest.request(query, {
        method: http.RequestMethod.GET,
        expectDataType: http.HttpDataType.STRING,
        connectTimeout: 10000,  // è¿æ¥è¶…æ—¶10ç§’
        readTimeout: 15000      // è¯»å–è¶…æ—¶15ç§’
      });

      // âœ… é¢å¤–çš„å…¨å±€è¶…æ—¶æ§åˆ¶
      const timeoutPromise = new Promise<never>((_, reject) => {
        this.requestTimeoutHandle = setTimeout(() => {
          reject(new Error('Request timeout after 20 seconds'));
        }, 20000);
      });

      const response = await Promise.race([requestPromise, timeoutPromise]) as http.HttpResponse;

      // æ¸…é™¤è¶…æ—¶å®šæ—¶å™¨
      if (this.requestTimeoutHandle !== null) {
        clearTimeout(this.requestTimeoutHandle);
        this.requestTimeoutHandle = null;
      }

      // âœ… æ£€æŸ¥å“åº”çŠ¶æ€
      if (response.responseCode !== 200) {
        throw new Error(`HTTP ${response.responseCode}: ${response.result}`);
      }

      const payload = JSON.parse(response.result as string);
      return this.mapToSnapshot(cityId, payload);

    } finally {
      // âœ… æ¸…ç†èµ„æº
      if (this.currentRequest) {
        this.currentRequest.destroy();
        this.currentRequest = null;
      }
      if (this.requestTimeoutHandle !== null) {
        clearTimeout(this.requestTimeoutHandle);
        this.requestTimeoutHandle = null;
      }
    }
  }

  /**
   * å–æ¶ˆå½“å‰è¯·æ±‚
   */
  cancelCurrentRequest(): void {
    if (this.currentRequest) {
      try {
        this.currentRequest.destroy();
        console.info('[WeatherService] Previous request cancelled');
      } catch (error) {
        let err = error as Error;
        console.warn('[WeatherService] Failed to cancel request:', err.message);
      }
      this.currentRequest = null;
    }

    if (this.requestTimeoutHandle !== null) {
      clearTimeout(this.requestTimeoutHandle);
      this.requestTimeoutHandle = null;
    }
  }

  /**
   * åˆ¤æ–­é”™è¯¯æ˜¯å¦å¯é‡è¯•
   */
  private isRetryableError(error: Error): boolean {
    const message = error.message.toLowerCase();

    // âœ… ä¸å¯é‡è¯•çš„é”™è¯¯
    const nonRetryablePatterns = [
      '404',        // èµ„æºä¸å­˜åœ¨
      '401',        // æœªæˆæƒ
      '403',        // ç¦æ­¢è®¿é—®
      'invalid',    // æ— æ•ˆå‚æ•°
      'parse error' // è§£æé”™è¯¯
    ];

    for (const pattern of nonRetryablePatterns) {
      if (message.includes(pattern)) {
        console.warn(`[WeatherService] Non-retryable error detected: ${pattern}`);
        return false;
      }
    }

    // âœ… å¯é‡è¯•çš„é”™è¯¯ï¼ˆç½‘ç»œé—®é¢˜ã€è¶…æ—¶ã€5xxé”™è¯¯ç­‰ï¼‰
    return true;
  }

  /**
   * è®¡ç®—é‡è¯•å»¶è¿Ÿï¼ˆæŒ‡æ•°é€€é¿ + éšæœºæŠ–åŠ¨ï¼‰
   */
  private calculateRetryDelay(attempt: number): number {
    // æŒ‡æ•°é€€é¿
    const exponentialDelay = this.retryConfig.baseDelay *
      Math.pow(this.retryConfig.backoffMultiplier, attempt - 1);

    // é™åˆ¶æœ€å¤§å»¶è¿Ÿ
    const cappedDelay = Math.min(exponentialDelay, this.retryConfig.maxDelay);

    // âœ… æ·»åŠ éšæœºæŠ–åŠ¨ï¼ˆÂ±25%ï¼‰
    const jitter = cappedDelay * 0.25 * (Math.random() * 2 - 1);

    return Math.floor(cappedDelay + jitter);
  }

  private sleep(ms: number): Promise<void> {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  private buildQuery(coordinates: Coordinates): string {
    return `${this.config.baseUrl}?latitude=${coordinates.latitude}&longitude=${coordinates.longitude}` +
      `&current_weather=true&hourly=temperature_2m,precipitation_probability` +
      `&daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_probability_max` +
      `&forecast_days=${this.config.dailyCount}&timezone=auto`;
  }

  // mapToSnapshotç­‰å…¶ä»–æ–¹æ³•ä¿æŒä¸å˜
  private mapToSnapshot(cityId: string, payload: any): WeatherSnapshot {
    // ç°æœ‰å®ç°
  }
}
```

#### éªŒæ”¶æ ‡å‡†

- [ ] ç½‘ç»œè¶…æ—¶åè‡ªåŠ¨é‡è¯•
- [ ] é‡è¯•3æ¬¡åä»å¤±è´¥åˆ™è¿”å›é”™è¯¯
- [ ] å¯ä»¥å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„è¯·æ±‚
- [ ] 5xxé”™è¯¯ä¼šé‡è¯•ï¼Œ4xxé”™è¯¯ä¸é‡è¯•
- [ ] ç½‘ç»œè¯·æ±‚æˆåŠŸç‡ â‰¥95%

#### é¢„ä¼°å·¥æ—¶

5å°æ—¶

---

### 3. å®šä½æœåŠ¡å¤šçº§å›é€€ç­–ç•¥

**é—®é¢˜**: å®šä½å¤±è´¥æ—¶ç¼ºå°‘å‹å¥½å¤„ç†

**é£é™©ç­‰çº§**: ğŸŸ¡ é«˜

**è§£å†³æ–¹æ¡ˆ**: åˆ›å»ºå¥å£®çš„å®šä½æœåŠ¡

#### å®ç°ä»£ç 

```typescript
// data/services/LocationService.ets

import geoLocationManager from '@ohos.geoLocationManager';
import abilityAccessCtrl, { Permissions } from '@ohos.abilityAccessCtrl';
import type common from '@ohos.app.ability.common';
import bundleManager from '@ohos.bundle.bundleManager';
import http from '@ohos.net.http';
import { Coordinates } from '../models/WeatherModels';

export enum LocationErrorCode {
  PERMISSION_DENIED = 201,
  LOCATION_SWITCH_OFF = 301,
  TIMEOUT = 401,
  UNAVAILABLE = 501
}

export class LocationService {
  private static instance: LocationService | null = null;
  private context: common.UIAbilityContext | null = null;

  private constructor() {}

  static getInstance(): LocationService {
    if (LocationService.instance === null) {
      LocationService.instance = new LocationService();
    }
    return LocationService.instance;
  }

  init(context: common.UIAbilityContext): void {
    this.context = context;
  }

  /**
   * è·å–å½“å‰ä½ç½®ï¼ˆå¤šçº§å›é€€ç­–ç•¥ï¼‰
   */
  async getCurrentLocation(): Promise<Coordinates> {
    if (!this.context) {
      throw new Error('LocationService not initialized');
    }

    try {
      // âœ… Step 1: æ£€æŸ¥å¹¶è¯·æ±‚æƒé™
      await this.ensureLocationPermission();

      // âœ… Step 2: æ£€æŸ¥å®šä½å¼€å…³
      await this.ensureLocationEnabled();

      // âœ… Step 3: è·å–å½“å‰ä½ç½®
      console.info('[LocationService] Getting current location...');

      const location = await geoLocationManager.getCurrentLocation({
        priority: geoLocationManager.LocationRequestPriority.FIRST_FIX,
        scenario: geoLocationManager.LocationRequestScenario.UNSET,
        maxAccuracy: 0,
        timeoutMs: 15000 // 15ç§’è¶…æ—¶
      });

      console.info(`[LocationService] âœ… Location obtained: (${location.latitude}, ${location.longitude})`);

      return {
        latitude: location.latitude,
        longitude: location.longitude
      };

    } catch (error) {
      return this.handleLocationError(error);
    }
  }

  /**
   * å¤„ç†å®šä½é”™è¯¯ï¼ˆå¤šçº§å›é€€ï¼‰
   */
  private async handleLocationError(error: Error | BusinessError): Promise<Coordinates> {
    const err = error as BusinessError;
    const errorCode = err.code || 0;

    console.error(`[LocationService] Location error [${errorCode}]:`, err.message);

    switch (errorCode) {
      case LocationErrorCode.PERMISSION_DENIED:
        // âœ… æƒé™è¢«æ‹’ç»ï¼šå¼•å¯¼ç”¨æˆ·å¼€å¯
        console.warn('[LocationService] Permission denied, showing guide');
        await this.showPermissionGuideDialog();
        throw new Error('éœ€è¦ä½ç½®æƒé™æ‰èƒ½è‡ªåŠ¨è·å–å¤©æ°”');

      case LocationErrorCode.LOCATION_SWITCH_OFF:
        // âœ… å®šä½å¼€å…³å…³é—­ï¼šå¼•å¯¼ç”¨æˆ·æ‰“å¼€
        console.warn('[LocationService] Location switch off, showing guide');
        await this.showLocationSwitchGuide();
        throw new Error('è¯·åœ¨ç³»ç»Ÿè®¾ç½®ä¸­å¼€å¯å®šä½åŠŸèƒ½');

      case LocationErrorCode.TIMEOUT:
        // âœ… å®šä½è¶…æ—¶ï¼šå°è¯•IPå®šä½
        console.warn('[LocationService] Timeout, falling back to IP location');
        return await this.fallbackToIPLocation();

      case LocationErrorCode.UNAVAILABLE:
      default:
        // âœ… å®šä½ä¸å¯ç”¨ï¼šä½¿ç”¨é»˜è®¤ä½ç½®ï¼ˆåŒ—äº¬ï¼‰
        console.warn('[LocationService] Location unavailable, using default location');
        return this.getDefaultLocation();
    }
  }

  /**
   * ç¡®ä¿æœ‰å®šä½æƒé™
   */
  private async ensureLocationPermission(): Promise<void> {
    const atManager = abilityAccessCtrl.createAtManager();
    const bundleInfo = await bundleManager.getBundleInfoForSelf(bundleManager.BundleFlag.GET_BUNDLE_INFO_WITH_APPLICATION);
    const tokenId = bundleInfo.appInfo.accessTokenId;

    // æ£€æŸ¥ç²¾ç¡®å®šä½æƒé™
    const locationPermission: Permissions = 'ohos.permission.LOCATION';
    const grantStatus = await atManager.checkAccessToken(tokenId, locationPermission);

    if (grantStatus === abilityAccessCtrl.GrantStatus.PERMISSION_DENIED) {
      console.info('[LocationService] Requesting location permission...');

      if (!this.context) {
        throw new Error('Context not available');
      }

      // è¯·æ±‚æƒé™
      const permissions: Permissions[] = [
        'ohos.permission.LOCATION',
        'ohos.permission.APPROXIMATELY_LOCATION'
      ];

      try {
        await atManager.requestPermissionsFromUser(this.context, permissions);
        console.info('[LocationService] âœ… Location permission granted');
      } catch (error) {
        let err = error as BusinessError;
        console.error('[LocationService] Permission request failed:', err.message);
        throw { code: LocationErrorCode.PERMISSION_DENIED, message: 'Permission denied' };
      }
    } else {
      console.info('[LocationService] Location permission already granted');
    }
  }

  /**
   * ç¡®ä¿å®šä½å¼€å…³å·²æ‰“å¼€
   */
  private async ensureLocationEnabled(): Promise<void> {
    const isEnabled = await geoLocationManager.isLocationEnabled();

    if (!isEnabled) {
      console.warn('[LocationService] Location switch is off');
      throw { code: LocationErrorCode.LOCATION_SWITCH_OFF, message: 'Location switch off' };
    }
  }

  /**
   * æ˜¾ç¤ºæƒé™å¼•å¯¼å¯¹è¯æ¡†
   */
  private async showPermissionGuideDialog(): Promise<void> {
    // âœ… ä½¿ç”¨AlertDialogå¼•å¯¼ç”¨æˆ·
    console.info('[LocationService] Should show permission guide dialog in UI layer');
  }

  /**
   * æ˜¾ç¤ºå®šä½å¼€å…³å¼•å¯¼
   */
  private async showLocationSwitchGuide(): Promise<void> {
    console.info('[LocationService] Should show location switch guide in UI layer');
  }

  /**
   * å›é€€åˆ°IPå®šä½ï¼ˆé€šè¿‡ç¬¬ä¸‰æ–¹APIï¼‰
   */
  private async fallbackToIPLocation(): Promise<Coordinates> {
    console.info('[LocationService] Attempting IP-based location...');

    try {
      // âœ… ä½¿ç”¨IPå®šä½APIï¼ˆä¾‹å¦‚ï¼šip-api.comï¼‰
      const httpRequest = http.createHttp();

      try {
        const response = await httpRequest.request('http://ip-api.com/json/', {
          method: http.RequestMethod.GET,
          expectDataType: http.HttpDataType.STRING,
          connectTimeout: 5000,
          readTimeout: 5000
        });

        if (response.responseCode === 200) {
          const data = JSON.parse(response.result as string);
          console.info(`[LocationService] âœ… IP location: (${data.lat}, ${data.lon})`);

          return {
            latitude: data.lat as number,
            longitude: data.lon as number
          };
        }
      } finally {
        httpRequest.destroy();
      }
    } catch (error) {
      let err = error as Error;
      console.error('[LocationService] IP location failed:', err.message);
    }

    // IPå®šä½ä¹Ÿå¤±è´¥ï¼Œè¿”å›é»˜è®¤ä½ç½®
    return this.getDefaultLocation();
  }

  /**
   * è·å–é»˜è®¤ä½ç½®ï¼ˆåŒ—äº¬ï¼‰
   */
  private getDefaultLocation(): Coordinates {
    console.info('[LocationService] Using default location: Beijing');
    return {
      latitude: 39.9042,  // åŒ—äº¬
      longitude: 116.4074
    };
  }
}
```

#### éªŒæ”¶æ ‡å‡†

- [ ] æƒé™æ‹’ç»æ—¶æ˜¾ç¤ºå¼•å¯¼å¯¹è¯æ¡†
- [ ] å®šä½å¤±è´¥åè‡ªåŠ¨å°è¯•IPå®šä½
- [ ] æ‰€æœ‰æ–¹æ³•å¤±è´¥åä½¿ç”¨é»˜è®¤ä½ç½®ï¼ˆåŒ—äº¬ï¼‰
- [ ] ç”¨æˆ·ä½“éªŒæµç•…ï¼Œæ— å¡é¡¿
- [ ] å®šä½æˆåŠŸç‡ â‰¥80%

#### é¢„ä¼°å·¥æ—¶

6å°æ—¶

---

## ğŸ”„ P2 ä¸­ä¼˜å…ˆçº§é¡¹ï¼ˆWeek 2ï¼‰

### 1. æ™ºèƒ½ç¼“å­˜ç­–ç•¥

**é—®é¢˜**: ç¼“å­˜æœ‰æ•ˆæœŸå›ºå®š30åˆ†é’Ÿï¼Œæ— æ³•é€‚åº”ä¸åŒå¤©æ°”ç±»å‹

**é£é™©ç­‰çº§**: ğŸŸ¢ ä¸­

**è§£å†³æ–¹æ¡ˆ**: æ ¹æ®å¤©æ°”ç±»å‹åŠ¨æ€è°ƒæ•´ç¼“å­˜æ—¶é•¿

#### å®ç°ä»£ç 

```typescript
// data/repository/WeatherRepository.ets - å¢å¼ºç¼“å­˜é€»è¾‘

import { City, WeatherSnapshot } from '../models/WeatherModels';
import { WeatherService } from '../services/WeatherService';
import { MockWeatherRepository } from '../../mock/MockWeatherRepository';
import { WeatherCacheStorage } from '../storage/WeatherCacheStorage';

export class WeatherRepository {
  private service: WeatherService;
  private mockRepo: MockWeatherRepository;
  private cacheStorage: WeatherCacheStorage;

  constructor(
    service: WeatherService,
    mockRepo: MockWeatherRepository,
    cacheStorage: WeatherCacheStorage
  ) {
    this.service = service;
    this.mockRepo = mockRepo;
    this.cacheStorage = cacheStorage;
  }

  async fetchWeather(city: City, forceRefresh: boolean): Promise<WeatherSnapshot> {
    // âœ… å¼ºåˆ¶åˆ·æ–°æ—¶è·³è¿‡ç¼“å­˜
    if (!forceRefresh) {
      const cached = await this.cacheStorage.get(city.id);
      if (cached && this.isCacheValid(cached)) {
        console.info(`[WeatherRepository] Using valid cache for ${city.name}`);
        return cached;
      }
    }

    // âœ… å°è¯•ä»APIè·å–
    try {
      const snapshot = await this.service.fetchWeather(city.id, city.coordinates);
      await this.cacheStorage.save(snapshot);
      console.info(`[WeatherRepository] âœ… Fetched and cached weather for ${city.name}`);
      return snapshot;
    } catch (error) {
      let err = error as Error;
      console.error(`[WeatherRepository] API failed for ${city.name}:`, err.message);

      // âœ… APIå¤±è´¥ï¼Œå°è¯•ä½¿ç”¨è¿‡æœŸç¼“å­˜
      const staleCache = await this.cacheStorage.get(city.id);
      if (staleCache) {
        console.warn(`[WeatherRepository] Using stale cache for ${city.name}`);
        // æ ‡è®°æ•°æ®ä¸ºè¿‡æœŸ
        staleCache.dataSource = `${staleCache.dataSource} (offline)`;
        return staleCache;
      }

      // âœ… æœ€åçš„å¤‡é€‰ï¼šMockæ•°æ®
      console.warn(`[WeatherRepository] Using mock data for ${city.name}`);
      return this.mockRepo.getMockWeather(city.id);
    }
  }

  /**
   * âœ… æ™ºèƒ½ç¼“å­˜æœ‰æ•ˆæ€§åˆ¤æ–­ï¼ˆæ ¹æ®å¤©æ°”ç±»å‹ï¼‰
   */
  private isCacheValid(snapshot: WeatherSnapshot): boolean {
    const lastUpdate = new Date(snapshot.lastUpdatedIso);
    const now = new Date();
    const diffMinutes = (now.getTime() - lastUpdate.getTime()) / (1000 * 60);

    // âœ… æ ¹æ®å¤©æ°”çŠ¶å†µè°ƒæ•´ç¼“å­˜æ—¶é•¿
    const cacheMinutes = this.getCacheDuration(snapshot);

    const isValid = diffMinutes < cacheMinutes;

    console.info(`[WeatherRepository] Cache age: ${diffMinutes.toFixed(1)}min, valid for: ${cacheMinutes}min, is valid: ${isValid}`);

    return isValid;
  }

  /**
   * âœ… æ ¹æ®å¤©æ°”ç±»å‹è¿”å›ç¼“å­˜æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
   */
  private getCacheDuration(snapshot: WeatherSnapshot): number {
    const weatherCode = snapshot.current.condition.iconCode.toLowerCase();

    // âœ… è§„åˆ™1ï¼šæç«¯å¤©æ°”ï¼ˆé›·æš´ã€æš´é›¨ï¼‰â†’ çŸ­ç¼“å­˜
    if (weatherCode.includes('thunder') || weatherCode.includes('storm')) {
      return 10; // 10åˆ†é’Ÿ
    }

    // âœ… è§„åˆ™2ï¼šä¸ç¨³å®šå¤©æ°”ï¼ˆé›¨ã€é›ªã€é›¾ï¼‰â†’ ä¸­ç­‰ç¼“å­˜
    if (weatherCode.includes('rain') || weatherCode.includes('snow') || weatherCode.includes('fog')) {
      return 20; // 20åˆ†é’Ÿ
    }

    // âœ… è§„åˆ™3ï¼šæ¸©åº¦å˜åŒ–å¤§ï¼ˆæ—©æ™šæ¸©å·®>15Â°ï¼‰â†’ ä¸­ç­‰ç¼“å­˜
    if (snapshot.daily.length > 0) {
      const todayForecast = snapshot.daily[0];
      const tempDiff = todayForecast.maxTempC - todayForecast.minTempC;
      if (tempDiff > 15) {
        return 25; // 25åˆ†é’Ÿ
      }
    }

    // âœ… è§„åˆ™4ï¼šæ™´æœ—ç¨³å®šå¤©æ°” â†’ é•¿ç¼“å­˜
    if (weatherCode.includes('sunny') || weatherCode.includes('clear')) {
      return 45; // 45åˆ†é’Ÿ
    }

    // âœ… é»˜è®¤ï¼š30åˆ†é’Ÿ
    return 30;
  }
}
```

#### éªŒæ”¶æ ‡å‡†

- [ ] æ™´å¤©ç¼“å­˜45åˆ†é’Ÿ
- [ ] é›·æš´ç¼“å­˜ä»…10åˆ†é’Ÿ
- [ ] ç¼“å­˜å¤±æ•ˆåè‡ªåŠ¨åˆ·æ–°
- [ ] ç¦»çº¿æ—¶æ˜¾ç¤ºè¿‡æœŸç¼“å­˜
- [ ] ç¼“å­˜å‘½ä¸­ç‡ â‰¥80%

#### é¢„ä¼°å·¥æ—¶

3å°æ—¶

---

### 2. æ¯›ç»ç’ƒæ€§èƒ½ä¼˜åŒ–

**é—®é¢˜**: å¤šå±‚blurå åŠ å¯¼è‡´GPUè¿‡è½½

**é£é™©ç­‰çº§**: ğŸŸ¢ ä¸­

**è§£å†³æ–¹æ¡ˆ**: ä¼˜åŒ–blurå±‚çº§å’Œæ¸²æŸ“ç­–ç•¥

#### å®ç°ä»£ç 

```typescript
// components/cards/CityWeatherCard.ets - ä¼˜åŒ–ç‰ˆ

import { CityWeatherState } from '../../viewmodel/WeatherController';

@Component
export struct CityWeatherCard {
  @Prop cityState: CityWeatherState;
  @State isHighlight: boolean = false;

  build() {
    Column() {
      // ä¸»è¦å†…å®¹
      this.renderMainContent();
    }
    .width('90%')
    .padding(24)
    // âœ… ä¼˜åŒ–1ï¼šæ ¹æ®çŠ¶æ€åŠ¨æ€è°ƒæ•´æ¨¡ç³Šåº¦
    .backdropBlur(this.isHighlight ? 15 : 10)
    // âœ… ä¼˜åŒ–2ï¼šå¼€å¯æ¸²æŸ“ç¼“å­˜
    .compositingStrategy(CompositingStrategy.OFFSCREEN)
    // âœ… ä¼˜åŒ–3ï¼šå‡å°‘é‡ç»˜
    .renderGroup(true)
    .backgroundColor('rgba(255, 255, 255, 0.15)')
    .borderRadius(20)
    .border({
      width: 1,
      color: 'rgba(255, 255, 255, 0.25)'
    })
    .shadow({
      radius: 15,
      color: 'rgba(0, 0, 0, 0.15)',
      offsetX: 0,
      offsetY: 4
    });
  }

  @Builder
  private renderMainContent(): void {
    // âŒ é¿å…åœ¨å†…å®¹åŒºåŸŸå†æ¬¡ä½¿ç”¨ .backdropBlur()
    Column() {
      // æ¸©åº¦æ˜¾ç¤º
      Text(`${this.cityState.snapshot?.current.temperatureC}Â°`)
        .fontSize(64)
        .fontWeight(FontWeight.Bold)
        .fontColor(Color.White);

      // å¤©æ°”æè¿°
      Text(this.cityState.snapshot?.current.condition.description || '')
        .fontSize(18)
        .fontColor('rgba(255, 255, 255, 0.9)');

      // å…¶ä»–å¤©æ°”ä¿¡æ¯
    }
    .width('100%');
  }
}
```

#### éªŒæ”¶æ ‡å‡†

- [ ] Swiperæ»‘åŠ¨å¸§ç‡ â‰¥50 FPS
- [ ] å†…å­˜ä½¿ç”¨å¢é‡ <30MB
- [ ] æ— å¡é¡¿æ„Ÿ
- [ ] blurå±‚çº§ä¸è¶…è¿‡2å±‚

#### é¢„ä¼°å·¥æ—¶

2å°æ—¶

---

## ğŸ” P3 ä½ä¼˜å…ˆçº§é¡¹ï¼ˆWeek 3-4ï¼‰

### 1. æ€§èƒ½ç›‘æ§é¢æ¿ï¼ˆå¼€å‘æ¨¡å¼ï¼‰

**ç›®æ ‡**: å®æ—¶ç›‘æ§åº”ç”¨æ€§èƒ½

#### å®ç°ä»£ç 

```typescript
// common/utils/PerformanceMonitor.ets

export class PerformanceMonitor {
  private static instance: PerformanceMonitor | null = null;
  private fpsCounter: number = 0;
  private lastFrameTime: number = Date.now();
  private isMonitoring: boolean = false;

  private constructor() {}

  static getInstance(): PerformanceMonitor {
    if (PerformanceMonitor.instance === null) {
      PerformanceMonitor.instance = new PerformanceMonitor();
    }
    return PerformanceMonitor.instance;
  }

  startMonitoring(): void {
    if (this.isMonitoring) {
      return;
    }

    // âœ… ä»…åœ¨å¼€å‘æ¨¡å¼å¯ç”¨
    const isDevelopment = true; // æ ¹æ®å®é™…ç¯å¢ƒåˆ¤æ–­
    if (!isDevelopment) {
      return;
    }

    this.isMonitoring = true;

    setInterval(() => {
      this.updateFPS();
      this.logMemoryUsage();
    }, 1000);
  }

  private updateFPS(): void {
    const now = Date.now();
    const fps = 1000 / (now - this.lastFrameTime);
    this.lastFrameTime = now;

    console.info(`[Performance] FPS: ${fps.toFixed(1)}`);

    if (fps < 30) {
      console.warn('[Performance] âš ï¸ Low FPS detected!');
    }
  }

  private logMemoryUsage(): void {
    console.info('[Performance] Memory usage monitoring...');
  }

  stopMonitoring(): void {
    this.isMonitoring = false;
  }
}
```

#### é¢„ä¼°å·¥æ—¶

3å°æ—¶

---

## ğŸ“… æ›´æ–°åçš„4å‘¨å®æ–½è®¡åˆ’

### Week 1ï¼šé£é™©ä¿®å¤ä¸åŸºç¡€å¢å¼º

| Day | Track F (åŠŸèƒ½) | Track V (è§†è§‰) | ä¼˜å…ˆçº§ | éªŒæ”¶æ ‡å‡† |
|-----|---------------|---------------|--------|----------|
| 1-2 | âœ… æ•°æ®åº“è¿ç§»æœºåˆ¶<br>âœ… æƒé™é…ç½®å®Œå–„<br>âœ… ä¿®å¤module.json5é€—å· | âœ… æ€§èƒ½æ£€æµ‹å™¨å®ç°<br>âœ… èƒŒæ™¯é™çº§é€»è¾‘ | P0 | æ— ç¼–è¯‘é”™è¯¯<br>æ•°æ®åº“å‡çº§æˆåŠŸ |
| 3-4 | âœ… ç½‘ç»œè¯·æ±‚é‡è¯•æœºåˆ¶<br>âœ… å®šä½æœåŠ¡å¤šçº§å›é€€ | âœ… è§†é¢‘èƒŒæ™¯æµ‹è¯•<br>âœ… AnimatedImageå‡†å¤‡ | P1 | é‡è¯•æˆåŠŸç‡â‰¥95%<br>å®šä½æˆåŠŸç‡â‰¥80% |
| 5-7 | âœ… CityStorageå®Œæ•´å®ç°<br>âœ… WeatherCacheStorageå®ç°<br>âœ… æµ‹è¯•çœŸå®API | âœ… æ¯›ç»ç’ƒæ€§èƒ½ä¼˜åŒ–<br>âœ… å¡ç‰‡åŠ¨ç”»æµç•…åº¦ | P1 | FPSâ‰¥50<br>APIå“åº”â‰¤3ç§’ |

**Week 1 éªŒæ”¶æ ‡å‡†ï¼š**
- [ ] æ•°æ®åº“å¯å‡çº§æ— æŠ¥é”™
- [ ] APIè¯·æ±‚å¤±è´¥è‡ªåŠ¨é‡è¯•
- [ ] å®šä½å¤±è´¥æœ‰å‹å¥½æç¤º
- [ ] èƒŒæ™¯æ ¹æ®è®¾å¤‡è‡ªåŠ¨é™çº§
- [ ] æ»‘åŠ¨æµç•…åº¦ â‰¥50 FPS

---

### Week 2ï¼šæ•°æ®æ•´åˆä¸ç”¨æˆ·ä½“éªŒ

| Day | Track F (åŠŸèƒ½) | Track V (è§†è§‰) | ä¼˜å…ˆçº§ | éªŒæ”¶æ ‡å‡† |
|-----|---------------|---------------|--------|----------|
| 8-10 | âœ… æ™ºèƒ½ç¼“å­˜ç­–ç•¥<br>âœ… åŸå¸‚å¢åˆ åŠŸèƒ½<br>âœ… ç¦»çº¿æ¨¡å¼æç¤º | âœ… ä¸‹æ‹‰åˆ·æ–°åŠ¨ç”»<br>âœ… åŠ è½½çŠ¶æ€ä¼˜åŒ– | P2 | ç¼“å­˜å‘½ä¸­ç‡â‰¥80%<br>ç¦»çº¿æ•°æ®å¯ç”¨ |
| 11-14 | âœ… 24å°æ—¶è¶‹åŠ¿å›¾(Chartä¼˜å…ˆ)<br>âœ… 3æ—¥å¤©æ°”å¡ç‰‡<br>âœ… æ™ºèƒ½å»ºè®®è§„åˆ™å¼•æ“ | âœ… è¶‹åŠ¿å›¾è§†è§‰æ‰“ç£¨<br>âœ… å¤œé—´æ¨¡å¼æ ·å¼ | P2 | è¶‹åŠ¿å›¾æ­£å¸¸æ˜¾ç¤º<br>å»ºè®®å‡†ç¡®ç‡â‰¥90% |

**Week 2 éªŒæ”¶æ ‡å‡†ï¼š**
- [ ] ç¦»çº¿æ—¶æ˜¾ç¤ºç¼“å­˜æ•°æ®
- [ ] ç¼“å­˜æ—¶é•¿æ ¹æ®å¤©æ°”è°ƒæ•´
- [ ] è¶‹åŠ¿å›¾æ­£å¸¸æ˜¾ç¤º
- [ ] æ·»åŠ /åˆ é™¤åŸå¸‚åŠŸèƒ½æ­£å¸¸

---

### Week 3ï¼šé«˜çº§åŠŸèƒ½ä¸æµ‹è¯•

| Day | Track F (åŠŸèƒ½) | Track V (è§†è§‰) | ä¼˜å…ˆçº§ | éªŒæ”¶æ ‡å‡† |
|-----|---------------|---------------|--------|----------|
| 15-17 | âœ… æ€§èƒ½æµ‹è¯•å¥—ä»¶<br>âœ… å¼‚å¸¸æµæµ‹è¯•<br>âœ… æ•°æ®åº“æŸåæ¢å¤æµ‹è¯• | âœ… åŠ¨æ•ˆèŠ‚å¥ç»Ÿä¸€<br>âœ… é…è‰²é€‚é…ä¼˜åŒ– | P3 | é€šè¿‡æ‰€æœ‰æµ‹è¯•<br>0ä¸ªä¸¥é‡bug |
| 18-21 | âœ… (å¯é€‰)æ‘‡ä¸€æ‘‡åˆ·æ–°<br>âœ… (å¯é€‰)åå°è‡ªåŠ¨æ›´æ–° | âœ… (å¯é€‰)è§†é¢‘èƒŒæ™¯å®Œå–„<br>âœ… æ¼”ç¤ºæ¨¡å¼å‡†å¤‡ | P3 | å¯é€‰åŠŸèƒ½ç¨³å®š |

**Week 3 éªŒæ”¶æ ‡å‡†ï¼š**
- [ ] é€šè¿‡æ‰€æœ‰æ€§èƒ½æµ‹è¯•
- [ ] å¼‚å¸¸åœºæ™¯æœ‰æ¢å¤æœºåˆ¶
- [ ] æ‰€æœ‰åŠŸèƒ½ç»è¿‡å‹åŠ›æµ‹è¯•

---

### Week 4ï¼šæ‰“ç£¨ä¸æ¼”ç¤ºå‡†å¤‡

| Day | Track F (åŠŸèƒ½) | Track V (è§†è§‰) | ä¼˜å…ˆçº§ | éªŒæ”¶æ ‡å‡† |
|-----|---------------|---------------|--------|----------|
| 22-24 | âœ… Bugä¿®å¤<br>âœ… æ—¥å¿—ä¼˜åŒ–<br>âœ… åº”æ€¥é¢„æ¡ˆå‡†å¤‡ | âœ… æœ€ç»ˆè§†è§‰è°ƒæ•´<br>âœ… æ¼”ç¤ºè„šæœ¬å½•åˆ¶ | P1 | 0ä¸ªé˜»å¡æ€§bug<br>åº”æ€¥é¢„æ¡ˆå®Œå¤‡ |
| 25-28 | âœ… å®Œæ•´æµ‹è¯•è½®<br>âœ… æ¼”ç¤ºå½©æ’<br>âœ… æ–‡æ¡£æ•´ç† | âœ… æ¼”ç¤ºç¯å¢ƒæ­å»º<br>âœ… åº”æ€¥èµ„æºå‡†å¤‡ | P1 | æ¼”ç¤ºæµç•…<br>æ–‡æ¡£å®Œæ•´ |

**Week 4 éªŒæ”¶æ ‡å‡†ï¼š**
- [ ] 0ä¸ªé˜»å¡æ€§bug
- [ ] æ¼”ç¤ºæµç¨‹æ— å¡é¡¿
- [ ] åº”æ€¥é¢„æ¡ˆæµ‹è¯•é€šè¿‡
- [ ] æ–‡æ¡£å®Œæ•´

---

## ğŸš¨ åº”æ€¥é¢„æ¡ˆä¸æ•…éšœæ¼”ç»ƒ

### 1. åº”æ€¥æ¼”ç¤ºè„šæœ¬

#### åœºæ™¯1ï¼šè§†é¢‘èƒŒæ™¯å´©æºƒ

**ç—‡çŠ¶**: é»‘å±ã€å¡é¡¿ã€é—ªé€€

**åº”æ€¥æ–¹æ¡ˆ**:
1. æŒ‰è®¾å¤‡èœå•é”® â†’ è®¾ç½®
2. é€‰æ‹©"é™æ€æ¸å˜èƒŒæ™¯"
3. è¿”å›åº”ç”¨ï¼ˆPlan Cå·²æ¿€æ´»ï¼‰

**é¢„è®¡æ¢å¤æ—¶é—´**: 5ç§’

---

#### åœºæ™¯2ï¼šçœŸå®APIä¸å¯ç”¨

**ç—‡çŠ¶**: æ•°æ®åŠ è½½å¤±è´¥

**åº”æ€¥æ–¹æ¡ˆ**:
1. å¿«é€Ÿç‚¹å‡»åˆ·æ–°æŒ‰é’®3æ¬¡ï¼ˆè§¦å‘Mockæ¨¡å¼ï¼‰
2. æˆ–ï¼šåœ¨ä»£ç ä¸­è®¾ç½® `USE_MOCK_DATA = true`

**é¢„è®¡æ¢å¤æ—¶é—´**: ç«‹å³ç”Ÿæ•ˆ

---

#### åœºæ™¯3ï¼šå®šä½æœåŠ¡å¼‚å¸¸

**ç—‡çŠ¶**: æ— æ³•è‡ªåŠ¨è·å–ä½ç½®

**åº”æ€¥æ–¹æ¡ˆ**:
1. ç‚¹å‡»"æ·»åŠ åŸå¸‚"æŒ‰é’®
2. æ‰‹åŠ¨è¾“å…¥"åŒ—äº¬"æˆ–"Shanghai"
3. æ¼”ç¤ºæ‰‹åŠ¨åŸå¸‚ç®¡ç†åŠŸèƒ½

**é¢„è®¡æ¢å¤æ—¶é—´**: 10ç§’

---

#### åœºæ™¯4ï¼šæ•°æ®åº“æŸå

**ç—‡çŠ¶**: å¯åŠ¨å´©æºƒ

**åº”æ€¥æ–¹æ¡ˆ**:
1. å¸è½½åº”ç”¨
2. é‡æ–°å®‰è£…å¤‡ç”¨å®‰è£…åŒ…
3. å¿«é€Ÿå¯¼å…¥æ¼”ç¤ºæ•°æ®

**é¢„è®¡æ¢å¤æ—¶é—´**: 1åˆ†é’Ÿ

---

### 2. åº”æ€¥èµ„æºæ¸…å•

#### å¿…å¤‡èµ„æº

- [ ] å¤‡ç”¨å®‰è£…åŒ…ï¼ˆHAPæ–‡ä»¶ï¼‰Ã— 2ä»½
- [ ] Mockæ•°æ®é…ç½®æ–‡ä»¶
- [ ] æ¼”ç¤ºç”¨åŸå¸‚åˆ—è¡¨
- [ ] é™æ€èƒŒæ™¯å›¾ç‰‡èµ„æº
- [ ] æ¼”ç¤ºè§†é¢‘å½•å±

#### å¤‡ç”¨è®¾å¤‡

- [ ] ä¸»æ¼”ç¤ºè®¾å¤‡ï¼ˆé«˜ç«¯æ‰‹æœºï¼‰
- [ ] å¤‡ç”¨æ¼”ç¤ºè®¾å¤‡ï¼ˆä¸­ç«¯æ‰‹æœºï¼‰
- [ ] å¼€å‘ç”µè„‘ï¼ˆéšæ—¶å¯é‡æ–°æ‰“åŒ…ï¼‰

---

## ğŸ“Š é‡åŒ–éªŒæ”¶æ ‡å‡†

### æ€§èƒ½æŒ‡æ ‡

| æµ‹è¯•é¡¹ | åˆæ ¼é˜ˆå€¼ | ä¼˜ç§€é˜ˆå€¼ | æµ‹è¯•æ–¹æ³• |
|--------|---------|---------|---------|
| **å†·å¯åŠ¨æ—¶é—´** | â‰¤2.0ç§’ | â‰¤1.5ç§’ | ä»ç‚¹å‡»å›¾æ ‡åˆ°é¦–å±å®Œå…¨æ¸²æŸ“ |
| **Swiperæ»‘åŠ¨** | â‰¥45 FPS | â‰¥55 FPS | è¿ç»­å¿«é€Ÿæ»‘åŠ¨5é¡µè®°å½•å¸§ç‡ |
| **è§†é¢‘æ’­æ”¾** | å†…å­˜+30MB | å†…å­˜+20MB | æ’­æ”¾1åˆ†é’Ÿå‰åå†…å­˜å·®å€¼ |
| **APIå“åº”** | â‰¤3ç§’ | â‰¤2ç§’ | å¹³å‡5æ¬¡è¯·æ±‚æ—¶é—´ |
| **ç¦»çº¿æ¢å¤** | â‰¤1ç§’ | â‰¤0.5ç§’ | åŠ è½½ç¼“å­˜æ•°æ®æ—¶é—´ |
| **æ•°æ®åº“è¿ç§»** | æ— æŠ¥é”™ | <500ms | ç‰ˆæœ¬1â†’ç‰ˆæœ¬2è¿ç§»æ—¶é—´ |
| **å®šä½è·å–** | â‰¤10ç§’ | â‰¤5ç§’ | GPSå®šä½æˆåŠŸæ—¶é—´ |
| **åŒ…å¤§å°** | â‰¤15MB | â‰¤10MB | æœ€ç»ˆHAPæ–‡ä»¶å¤§å° |

### åŠŸèƒ½æŒ‡æ ‡

| æµ‹è¯•é¡¹ | åˆæ ¼æ ‡å‡† | æµ‹è¯•æ–¹æ³• |
|--------|---------|---------|
| **ç½‘ç»œè¯·æ±‚æˆåŠŸç‡** | â‰¥95% | 100æ¬¡è¯·æ±‚ç»Ÿè®¡ |
| **å®šä½æˆåŠŸç‡** | â‰¥80% | 10æ¬¡å®šä½å°è¯• |
| **ç¼“å­˜å‘½ä¸­ç‡** | â‰¥80% | æ­£å¸¸ä½¿ç”¨1å¤©ç»Ÿè®¡ |
| **æ•°æ®åº“è¿ç§»æˆåŠŸç‡** | 100% | 10æ¬¡å‡çº§æµ‹è¯• |
| **è§†é¢‘é™çº§æ­£ç¡®ç‡** | 100% | ä¸åŒè®¾å¤‡æµ‹è¯• |

### ç”¨æˆ·ä½“éªŒæŒ‡æ ‡

| æµ‹è¯•é¡¹ | åˆæ ¼æ ‡å‡† | æµ‹è¯•æ–¹æ³• |
|--------|---------|---------|
| **å¼‚å¸¸æ¢å¤æ—¶é—´** | â‰¤3ç§’ | æ¨¡æ‹Ÿå„ç§å¼‚å¸¸ |
| **é”™è¯¯æç¤ºå‡†ç¡®ç‡** | â‰¥95% | ç”¨æˆ·ç†è§£åº¦æµ‹è¯• |
| **æ“ä½œæµç•…åº¦** | æ— å¡é¡¿ | ä¸»è§‚è¯„ä»·+å¸§ç‡ |

---

## âœ… ç«‹å³æ‰§è¡Œæ¸…å•

### ä»Šå¤©å¿…åšï¼ˆ2-3å°æ—¶ï¼‰

**ä¼˜å…ˆçº§**: ğŸ”´ P0

1. **ä¿®å¤module.json5**
   - åˆ é™¤ç¬¬47è¡Œå¤šä½™é€—å·
   - éªŒè¯ï¼šé¡¹ç›®å¯ç¼–è¯‘

2. **å®Œå–„æƒé™é…ç½®**
   - æ·»åŠ æ‰€æœ‰å¿…éœ€æƒé™åˆ°module.json5
   - æ·»åŠ å¯¹åº”çš„å­—ç¬¦ä¸²èµ„æº
   - éªŒè¯ï¼šå®‰è£…æ—¶æ­£ç¡®æ˜¾ç¤ºæƒé™

3. **å®ç°æ•°æ®åº“è¿ç§»**
   - åœ¨CityStorageä¸­å¢åŠ ç‰ˆæœ¬ç®¡ç†
   - å®ç°migrate()æ–¹æ³•
   - éªŒè¯ï¼šç‰ˆæœ¬å‡çº§æ— æŠ¥é”™

---

### æœ¬å‘¨å¿…åšï¼ˆDay 1-7ï¼‰

**ä¼˜å…ˆçº§**: ğŸŸ¡ P1

4. **æ€§èƒ½æ£€æµ‹å™¨**
   - åˆ›å»ºDevicePerformanceDetector.ets
   - é›†æˆåˆ°AtmosphereBackground
   - éªŒè¯ï¼šä½ç«¯è®¾å¤‡è‡ªåŠ¨é™çº§

5. **ç½‘ç»œé‡è¯•æœºåˆ¶**
   - å¢å¼ºWeatherService
   - æ·»åŠ è¶…æ—¶å’Œé‡è¯•é€»è¾‘
   - éªŒè¯ï¼šç½‘ç»œå¤±è´¥åè‡ªåŠ¨é‡è¯•

6. **å®šä½å¤šçº§å›é€€**
   - åˆ›å»ºLocationService
   - å®ç°GPS â†’ IP â†’ é»˜è®¤ä½ç½®å›é€€
   - éªŒè¯ï¼šå®šä½å¤±è´¥æœ‰å‹å¥½æç¤º

7. **èƒŒæ™¯è‡ªåŠ¨é™çº§**
   - å®ç°è§†é¢‘ â†’ åŠ¨å›¾ â†’ æ¸å˜é™çº§
   - æ·»åŠ é”™è¯¯ç›‘å¬
   - éªŒè¯ï¼šåŠ è½½å¤±è´¥è‡ªåŠ¨é™çº§

---

### ä¸‹å‘¨å¿…åšï¼ˆWeek 2ï¼‰

**ä¼˜å…ˆçº§**: ğŸŸ¢ P2

8. **æ™ºèƒ½ç¼“å­˜**
   - æ ¹æ®å¤©æ°”ç±»å‹è°ƒæ•´ç¼“å­˜æ—¶é•¿
   - éªŒè¯ï¼šé›·æš´10åˆ†é’Ÿï¼Œæ™´å¤©45åˆ†é’Ÿ

9. **æ¯›ç»ç’ƒä¼˜åŒ–**
   - å‡å°‘blurå±‚çº§
   - æ·»åŠ æ¸²æŸ“ç¼“å­˜
   - éªŒè¯ï¼šFPS â‰¥50

10. **åŸå¸‚ç®¡ç†**
    - å®ç°å¢åˆ åŠŸèƒ½
    - éªŒè¯ï¼šæ“ä½œæµç•…æ— è¯¯

---

## ğŸ¯ æ€»ç»“ï¼šæ•´æ”¹çš„æ ¸å¿ƒä»·å€¼

### å®˜æ–¹è¯‰æ±‚

HarmonyOSå®˜æ–¹è¯„å®¡çš„æ ¸å¿ƒè¯‰æ±‚æ˜¯**é˜²å¾¡å¼ç¼–ç¨‹**å’Œ**ç”Ÿäº§çº§è´¨é‡**ã€‚

### æœ¬æ–¹æ¡ˆçš„æ ¸å¿ƒä»·å€¼

é€šè¿‡æœ¬æ•´æ”¹æ–¹æ¡ˆï¼Œä½ å°†è·å¾—ï¼š

1. **å¥å£®æ€§æå‡200%**
   - å¼‚å¸¸æ¢å¤æœºåˆ¶
   - å¤šçº§å›é€€ç­–ç•¥
   - è‡ªåŠ¨é™çº§å¤„ç†

2. **æ€§èƒ½é‡åŒ–ç®¡ç†**
   - æ˜ç¡®çš„æŒ‡æ ‡ä½“ç³»
   - ç³»ç»ŸåŒ–æµ‹è¯•æ–¹æ³•
   - å®æ—¶æ€§èƒ½ç›‘æ§

3. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
   - ç½‘ç»œå¤±è´¥ä¼˜é›…é™çº§
   - å®šä½å¤±è´¥å‹å¥½æç¤º
   - èµ„æºåŠ è½½å¤±è´¥è‡ªåŠ¨å¤„ç†

4. **å¯ç»´æŠ¤æ€§å¢å¼º**
   - æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†
   - æ¸…æ™°çš„é”™è¯¯åˆ†ç±»
   - å®Œæ•´çš„æ—¥å¿—ç³»ç»Ÿ

5. **æ¼”ç¤ºé›¶é£é™©**
   - å®Œæ•´çš„åº”æ€¥é¢„æ¡ˆ
   - æ•…éšœæ¢å¤æœºåˆ¶
   - å¤šå¥—å¤‡ç”¨æ–¹æ¡ˆ

### æ‰§è¡Œå»ºè®®

- **ç¬¬1å¤©**: å®ŒæˆP0ç´§æ€¥é¡¹
- **ç¬¬2-7å¤©**: å®ŒæˆP1é«˜ä¼˜å…ˆçº§é¡¹
- **ç¬¬8-14å¤©**: å®ŒæˆP2ä¸­ä¼˜å…ˆçº§é¡¹
- **ç¬¬15-28å¤©**: æµ‹è¯•ã€æ‰“ç£¨ã€å‡†å¤‡æ¼”ç¤º

### æœ€ç»ˆç›®æ ‡

æŒ‰ç…§è¿™ä¸ªèŠ‚å¥ï¼Œä½ å°†åœ¨4å‘¨å†…äº¤ä»˜ä¸€ä¸ª**ç”Ÿäº§çº§æ°´å‡†**çš„å¤©æ°”åº”ç”¨ï¼ŒåŒæ—¶ä¿æŒå­¦ç”Ÿé¡¹ç›®çš„å¯å®ç°æ€§ï¼

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- åŸå§‹å®éªŒæ–¹æ¡ˆï¼š`ExperimentPlan.md`
- æ³¨æ„äº‹é¡¹æ–‡æ¡£ï¼š`attention/` ç›®å½•
- HarmonyOSå®˜æ–¹æ–‡æ¡£ï¼šhttps://developer.harmonyos.com

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0
**åˆ›å»ºæ—¶é—´**: 2025å¹´11æœˆ11æ—¥
**æœ€åæ›´æ–°**: 2025å¹´11æœˆ11æ—¥
**çŠ¶æ€**: âœ… å·²å®Œæˆ
