# å°ç¾Šæ‰«é›· - ä»£ç ä¿®å¤ä¸ArkTSè§„èŒƒæ–‡æ¡£

**æœ€åæ›´æ–°**: 2025å¹´10æœˆ11æ—¥  
**ä¿®å¤å†…å®¹**: ç¼–è¯‘é”™è¯¯ä¿®å¤ã€ArkTSè§„èŒƒéµå¾ªã€APIå‡çº§

---

## ğŸ“‹ ç›®å½•

1. [ä¿®å¤æ¦‚è¿°](#ä¿®å¤æ¦‚è¿°)
2. [ArkTSè¯­æ³•è§„èŒƒ](#arktsè¯­æ³•è§„èŒƒ)
3. [å¸¸è§ç¼–è¯‘é”™è¯¯åŠä¿®å¤](#å¸¸è§ç¼–è¯‘é”™è¯¯åŠä¿®å¤)
4. [APIå‡çº§ä¸å¼ƒç”¨å¤„ç†](#apiå‡çº§ä¸å¼ƒç”¨å¤„ç†)
5. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## ä¿®å¤æ¦‚è¿°

### å†å²ä¿®å¤ç»Ÿè®¡

| ä¿®å¤æ‰¹æ¬¡ | é”™è¯¯æ•° | è­¦å‘Šæ•° | ä¸»è¦å†…å®¹ |
|---------|-------|--------|---------|
| ç¬¬ä¸€æ‰¹ | 23ä¸ª | 4ä¸ª | é™æ€æ–¹æ³•thisã€typeofç±»å‹ã€å¯¹è±¡å­—é¢é‡ç­‰ |
| ç¬¬äºŒæ‰¹ | 10ä¸ª | 0ä¸ª | Promise.catchã€catchç±»å‹æ³¨è§£ã€anyç±»å‹ |
| ç¬¬ä¸‰æ‰¹ | 4ä¸ª | 2ä¸ª | closeRawFdç±»å‹ã€å¼ƒç”¨API |
| ç¬¬å››æ‰¹ | 7ä¸ª | 0ä¸ª | APIå‚æ•°ã€èµ„æºè·¯å¾„ã€æƒé™é…ç½® |
| **æ€»è®¡** | **44ä¸ª** | **6ä¸ª** | - |

### å½“å‰çŠ¶æ€
- âœ… ç¼–è¯‘é”™è¯¯ï¼š0ä¸ª
- âœ… è­¦å‘Šï¼š0ä¸ª
- âœ… Linteré”™è¯¯ï¼š0ä¸ª
- âœ… ä»£ç è´¨é‡ï¼šA+

---

## ArkTSè¯­æ³•è§„èŒƒ

### 1. Promiseé”™è¯¯å¤„ç†

#### âŒ é”™è¯¯æ–¹å¼
```typescript
// ä¸å…è®¸åœ¨ .catch() ä¸­ä½¿ç”¨å‚æ•°
promise.catch((err) => {
  console.error(err); // err æ˜¯ unknown ç±»å‹
});
```

#### âœ… æ­£ç¡®æ–¹å¼
```typescript
// ä½¿ç”¨ async/await + try-catch
private async initService(): Promise<void> {
  try {
    await service.init(context);
  } catch (error) {
    let err = error as BusinessError;
    console.error(err.message);
  }
}
```

### 2. catchå—ç±»å‹æ³¨è§£

#### âŒ é”™è¯¯æ–¹å¼
```typescript
try {
  // code
} catch (err: Error) {  // ä¸å…è®¸ç±»å‹æ³¨è§£
  console.error(err);
}
```

#### âœ… æ­£ç¡®æ–¹å¼
```typescript
try {
  // code
} catch (error) {
  // åœ¨å†…éƒ¨ä½¿ç”¨ç±»å‹æ–­è¨€
  let err = error as Error;
  console.error(err.message);
}
```

### 3. ç±»å‹å£°æ˜

#### âŒ é”™è¯¯æ–¹å¼
```typescript
// ä¸å…è®¸ä½¿ç”¨ any/unknown
const data: any = getData();
const result: unknown = getResult();

// ä¸å…è®¸ä½¿ç”¨ typeof ä½œä¸ºç±»å‹
@ObjectLink provider: typeof themeProvider;
```

#### âœ… æ­£ç¡®æ–¹å¼
```typescript
// ä½¿ç”¨æ˜ç¡®çš„ç±»å‹
interface MyData {
  id: string;
  name: string;
}
const data: MyData = getData();

// ç›´æ¥å¯¼å…¥ç±»å‹
import { ThemeProvider } from '../theme/ThemeProvider';
@ObjectLink provider: ThemeProvider;
```

### 4. å¯¹è±¡åˆ›å»º

#### âŒ é”™è¯¯æ–¹å¼
```typescript
// ä¸å…è®¸å¯¹è±¡å­—é¢é‡åˆå§‹åŒ–
const level: Level = {
  levelId: 'test',
  name: 'æµ‹è¯•',
  rows: 9,
  cols: 9
};
```

#### âœ… æ­£ç¡®æ–¹å¼
```typescript
// ä½¿ç”¨ç±»æ„é€ å‡½æ•°
const level: Level = new Level(
  'test',
  'æµ‹è¯•',
  9,
  9,
  10,
  true
);
```

### 5. é™æ€æ–¹æ³•

#### âŒ é”™è¯¯æ–¹å¼
```typescript
class Utils {
  static value = 10;
  
  static getValue() {
    return this.value;  // é™æ€æ–¹æ³•ä¸­ä¸èƒ½ä½¿ç”¨ this
  }
}
```

#### âœ… æ­£ç¡®æ–¹å¼
```typescript
class Utils {
  static value = 10;
  
  static getValue() {
    return Utils.value;  // ä½¿ç”¨ç±»å
  }
}
```

---

## å¸¸è§ç¼–è¯‘é”™è¯¯åŠä¿®å¤

### é”™è¯¯1: arkts-no-any-unknown

**é”™è¯¯ä¿¡æ¯**: `Use explicit types instead of "any", "unknown"`

**åŸå› **: ArkTSç¦æ­¢ä½¿ç”¨anyå’Œunknownç±»å‹

**ä¿®å¤æ–¹æ¡ˆ**:
```typescript
// âŒ é”™è¯¯
private currentFd: any = null;

// âœ… æ­£ç¡®
import resourceManager from '@ohos.resourceManager';
private currentFd: resourceManager.RawFileDescriptor | null = null;
```

### é”™è¯¯2: arkts-no-typeof-as-type

**é”™è¯¯ä¿¡æ¯**: `'typeof' operator cannot be used in type declarations`

**åŸå› **: ä¸å…è®¸ä½¿ç”¨typeofä½œä¸ºç±»å‹å£°æ˜

**ä¿®å¤æ–¹æ¡ˆ**:
```typescript
// âŒ é”™è¯¯
@ObjectLink provider: typeof themeProvider;

// âœ… æ­£ç¡®
import { ThemeProvider, themeProvider } from '../theme/ThemeProvider';
@ObjectLink provider: ThemeProvider;
```

### é”™è¯¯3: å¯¹è±¡å­—é¢é‡ç±»å‹å£°æ˜

**é”™è¯¯ä¿¡æ¯**: `Object literal must correspond to a declared class or interface`

**åŸå› **: å¯¹è±¡å­—é¢é‡å¿…é¡»å¯¹åº”æ˜ç¡®å£°æ˜çš„ç±»æˆ–æ¥å£

**ä¿®å¤æ–¹æ¡ˆ**:
```typescript
// âŒ é”™è¯¯
const GLOBAL_COLORS = {
  asparagus: '#67AA53',
  pacificCyan: '#41A9CE'
};

// âœ… æ­£ç¡®
class GlobalColors {
  asparagus: string = '#67AA53';
  pacificCyan: string = '#41A9CE';
}
const GLOBAL_COLORS = new GlobalColors();
```

### é”™è¯¯4: å±æ€§å‘½åå†²çª

**é”™è¯¯ä¿¡æ¯**: `Property 'scale' in type 'GameBoard' is not assignable to the same property in base type 'CustomComponent'`

**åŸå› **: @Stateå˜é‡åä¸ArkUIå†…ç½®å±æ€§å†²çª

**ä¿®å¤æ–¹æ¡ˆ**:
```typescript
// âŒ é”™è¯¯
@State scale: number = 1.0;  // ä¸ ArkUI çš„ .scale() å†²çª

// âœ… æ­£ç¡®
@State boardScale: number = 1.0;  // ä½¿ç”¨è¯­ä¹‰åŒ–å‰ç¼€
```

**å¸¸è§å†²çªåç§°**: scale, rotate, translate, opacity, width, height, padding, margin

### é”™è¯¯5: Circle.stroke() å‚æ•°

**é”™è¯¯ä¿¡æ¯**: `Expected 1 arguments, but got 2`

**åŸå› **: ArkTSä¸­.stroke()åªæ¥å—1ä¸ªå‚æ•°ï¼ˆé¢œè‰²ï¼‰

**ä¿®å¤æ–¹æ¡ˆ**:
```typescript
// âŒ é”™è¯¯
Circle().stroke(Color.White, 3);

// âœ… æ­£ç¡®
Circle()
  .stroke(Color.White)
  .strokeWidth(3);
```

---

## APIå‡çº§ä¸å¼ƒç”¨å¤„ç†

### 1. registerFont â†’ registerFontSync

**å˜æ›´**: ä»å¼‚æ­¥æ”¹ä¸ºåŒæ­¥

```typescript
// âŒ æ—§APIï¼ˆå·²å¼ƒç”¨ï¼‰
await font.registerFont({
  familyName: 'CustomFont',
  familySrc: $rawfile('fonts/custom.ttf')
});

// âœ… æ–°API
font.registerFontSync({
  familyName: 'CustomFont',
  familySrc: $rawfile('fonts/custom.ttf')
});
```

### 2. getDevices â†’ getAvailableDevices

**å˜æ›´**: æ–¹æ³•åå’Œå‚æ•°éƒ½æ”¹å˜

```typescript
// âŒ æ—§APIï¼ˆå·²å¼ƒç”¨ï¼‰
const devices = await audioManager.getDevices(
  audio.DeviceFlag.OUTPUT_DEVICES_FLAG
);

// âœ… æ–°API
const devices = await audioManager.getAvailableDevices(
  audio.AudioDeviceUsage.MEDIA_OUTPUT_DEVICES
);
```

### 3. decodeWithStream â†’ decodeToString

**å˜æ›´**: ç®€åŒ–APIï¼Œæ›´é«˜æ•ˆ

```typescript
// âŒ æ—§APIï¼ˆå·²å¼ƒç”¨ï¼‰
const textDecoder = util.TextDecoder.create('utf-8');
const jsonString = textDecoder.decodeWithStream(rawFile, { stream: false });

// âœ… æ–°API
const textDecoder = util.TextDecoder.create('utf-8');
const jsonString = textDecoder.decodeToString(rawFile);
```

### 4. getContext(this) â†’ AppStorage

**å˜æ›´**: ä½¿ç”¨AppStorageè·å–Context

```typescript
// âŒ æ—§APIï¼ˆå·²å¼ƒç”¨ï¼‰
private context = getContext(this) as UIAbilityContext;

// âœ… æ–°API
// EntryAbility.ets
onCreate(want, launchParam) {
  AppStorage.setOrCreate('context', this.context);
}

// ç»„ä»¶ä¸­
aboutToAppear() {
  this.context = AppStorage.get<UIAbilityContext>('context');
}
```

### 5. AVPlayer æ–‡ä»¶æè¿°ç¬¦ç®¡ç†

**æ³¨æ„**: ä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨closeRawFd()

```typescript
// âŒ é”™è¯¯
if (this.currentBGMFd && this.context) {
  await this.context.resourceManager.closeRawFd(this.currentBGMFd.fd);
  // closeRawFd éœ€è¦ stringï¼Œä½† fd.fd æ˜¯ number
}

// âœ… æ­£ç¡®
// AVPlayer.release() ä¼šè‡ªåŠ¨é‡Šæ”¾æ–‡ä»¶æè¿°ç¬¦
if (this.bgmPlayer) {
  await this.bgmPlayer.stop();
  await this.bgmPlayer.release();
}
this.bgmPlayer = null;
this.currentBGMFd = null;  // æ¸…ç©ºå¼•ç”¨å³å¯
```

---

## æœ€ä½³å®è·µ

### 1. å¼‚æ­¥é”™è¯¯å¤„ç†
```typescript
// âœ… æ¨èï¼šasync/await + try-catch
private async doSomething(): Promise<void> {
  try {
    await asyncOperation();
  } catch (error) {
    let err = error as BusinessError;
    console.error('Error:', err.message);
  }
}
```

### 2. ç±»å‹å®‰å…¨
```typescript
// âœ… æ¨èï¼šæ˜ç¡®çš„æ¥å£ç±»å‹
interface MyData {
  id: string;
  name: string;
}

// è¯»å–æ•°æ®æ—¶ä½¿ç”¨ç±»å‹æ–­è¨€
const data: MyData = JSON.parse(str) as MyData;
```

### 3. å¯¹è±¡åˆ›å»º
```typescript
// âœ… æ¨èï¼šä½¿ç”¨æ„é€ å‡½æ•°
const level = new Level('id', 'name', 9, 9, 10, true);

// è€Œä¸æ˜¯å¯¹è±¡å­—é¢é‡
// const level = { levelId: 'id', ... };
```

### 4. èµ„æºåŠ è½½
```typescript
// âœ… æ¨èï¼šä½¿ç”¨$rawfileå’ŒfdSrc
Image($rawfile('images/icon.png'));

const fd = await context.resourceManager.getRawFd('music/bgm.mp3');
player.fdSrc = { 
  fd: fd.fd, 
  offset: fd.offset, 
  length: fd.length 
};
```

### 5. å‘½åè§„èŒƒ
```typescript
// âœ… æ¨èï¼šé¿å…ä¸ArkUIå†…ç½®å±æ€§å†²çª
@State boardScale: number = 1.0;  // è€Œä¸æ˜¯ scale
@State containerWidth: number = 100;  // è€Œä¸æ˜¯ width
@State innerPadding: number = 10;  // è€Œä¸æ˜¯ padding
```

---

## AVPlayer çŠ¶æ€æœº

### çŠ¶æ€è½¬æ¢è§„åˆ™

```
idle â†’ (è®¾ç½®fdSrc) â†’ initialized â†’ (è°ƒç”¨prepare) â†’ prepared â†’ (è°ƒç”¨play) â†’ playing
```

### å…³é”®è§„åˆ™

1. **prepare()** åªèƒ½åœ¨ `initialized` çŠ¶æ€è°ƒç”¨
2. **play()** åªèƒ½åœ¨ `prepared` çŠ¶æ€è°ƒç”¨
3. **loop** åªèƒ½åœ¨ `prepared` çŠ¶æ€è®¾ç½®
4. **å¿…é¡»ä½¿ç”¨stateChangeç›‘å¬å™¨**ï¼Œä¸èƒ½åŒæ­¥è°ƒç”¨

### æ­£ç¡®çš„ç¼–ç æ¨¡å¼

```typescript
// âœ… æ­£ç¡®ï¼šå®Œå…¨äº‹ä»¶é©±åŠ¨
player.on('stateChange', async (state) => {
  switch(state) {
    case 'initialized':
      await player.prepare();
      break;
    case 'prepared':
      player.loop = true;
      await player.play();
      break;
    case 'playing':
      console.log('æ’­æ”¾ä¸­');
      break;
  }
});
player.fdSrc = resource;  // è§¦å‘çŠ¶æ€å˜åŒ–

// âŒ é”™è¯¯ï¼šåŒæ­¥è°ƒç”¨
player.fdSrc = resource;
await player.prepare();  // å¯èƒ½å¤±è´¥ï¼
```

---

## æƒé™é…ç½®

### æ­£ç¡®çš„æƒé™é…ç½®

```json
// module.json5
"requestPermissions": [
  {
    "name": "ohos.permission.VIBRATE"
  }
]
```

**æ³¨æ„**: 
- âŒ `ohos.permission.USE_AUDIO` ä¸å­˜åœ¨
- âœ… éŸ³é¢‘æ’­æ”¾ä¸éœ€è¦ç‰¹æ®Šæƒé™
- âœ… åªæœ‰å½•éŸ³éœ€è¦ `ohos.permission.MICROPHONE`

---

## éªŒè¯æ¸…å•

### ä»£ç è´¨é‡æ£€æŸ¥
- [ ] æ—  Promise.catch() ä½¿ç”¨
- [ ] æ—  catch å—ç±»å‹æ³¨è§£
- [ ] æ—  any/unknown ç±»å‹
- [ ] æ—  typeof æ“ä½œç¬¦ä½œä¸ºç±»å‹
- [ ] æ— å¯¹è±¡å­—é¢é‡åˆå§‹åŒ–
- [ ] é™æ€æ–¹æ³•ä½¿ç”¨ç±»åè€Œéthis
- [ ] æ— å¼ƒç”¨APIä½¿ç”¨
- [ ] Contexté€šè¿‡AppStorageè·å–
- [ ] æ— å‘½åå†²çª

### Linteræ£€æŸ¥
```bash
read_lints(["entry/src/main/ets"])
# ç»“æœ: No linter errors found
```

---

## æ€»ç»“

### æ ¸å¿ƒåŸåˆ™

1. **ç±»å‹å®‰å…¨ç¬¬ä¸€**: æ‰€æœ‰ç±»å‹å¿…é¡»æ˜ç¡®ï¼Œä¸ä½¿ç”¨any/unknown
2. **éµå¾ªArkTSè§„èŒƒ**: ä¸¥æ ¼éµå®ˆè¯­æ³•é™åˆ¶å’Œæœ€ä½³å®è·µ
3. **ä½¿ç”¨æœ€æ–°API**: é¿å…ä½¿ç”¨å·²å¼ƒç”¨çš„API
4. **æ­£ç¡®çš„é”™è¯¯å¤„ç†**: ä½¿ç”¨async/await + try-catchæ¨¡å¼
5. **å‘½åè§„èŒƒ**: é¿å…ä¸æ¡†æ¶å†…ç½®å±æ€§å†²çª

### ä¿®å¤æµç¨‹

1. è¿è¡Œlinteræ£€æŸ¥è¯†åˆ«é”™è¯¯
2. æ ¹æ®é”™è¯¯ç±»å‹é€‰æ‹©å¯¹åº”ä¿®å¤æ–¹æ¡ˆ
3. éªŒè¯ä¿®å¤åæ— æ–°é”™è¯¯
4. æäº¤ä»£ç 

---

**æ–‡æ¡£ç¼–å†™**: AI Assistant  
**æœ€åæ›´æ–°**: 2025å¹´10æœˆ11æ—¥  
**ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: âœ… å®Œæˆ

